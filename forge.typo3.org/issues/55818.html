<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/55818 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:17:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Story #55818: Configurable NodeType constraints - Base Distribution - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/55818.atom" rel="alternate" title="Base Distribution - Story #55818: Configurable NodeType constraints" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 current sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/search" accesskey="4" style="">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>Base Distribution</h1>
        <div id="quicklinks"></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/rb/master_backlog/typo3neos-distribution-base" class="rb-master-backlogs">Backlogs</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base" class="level-1 current sorting-0">Base Distribution</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-form" class="level-2 sorting-0">TYPO3.Form</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-imagine" class="level-2 sorting-0">TYPO3.Imagine</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-media" class="level-2 sorting-0">TYPO3.Media</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-neos" class="level-2 sorting-0">TYPO3.Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-neos-nodetypes" class="level-2 sorting-0">TYPO3.Neos.NodeTypes</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-party" class="level-2 sorting-0">TYPO3.Party</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-setup" class="level-2 sorting-0">TYPO3.Setup</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-sitekickstarter" class="level-2 sorting-0">TYPO3.SiteKickstarter</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-twitter-bootstrap" class="level-2 sorting-0">TYPO3.Twitter.Bootstrap</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-neoscr" class="level-2 sorting-0">TYPO3.TYPO3CR</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-typoscript" class="level-2 sorting-0">TYPO3.TypoScript</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-coordination" class="level-1 sorting-0">Coordination Group</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-website-communication" class="level-1 sorting-0">Website and Communication</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues/report">Summary</a><br />






            <div id="backlogs_view_issues_sidebar"></div>
            <script type="text/javascript">
              jQuery(document).ready(function() {
                jQuery('#backlogs_view_issues_sidebar').load('../../external.html?link=https://forge.typo3.org/rb/hooks/sidebar/project/typo3neos-distribution-base');
              });
            </script>
          

<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=434" class="query">! Stories This Sprint</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=435" class="query">! Work Packages</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/issues?query_id=204" class="query">Recently modified</a>



  
    <div id="watchers">
      

<h3>Watchers (1)</h3>

<ul><li><a href="../../external.html?link=https://forge.typo3.org/users/40298">Manuel Ruck</a></li></ul>

    </div>
  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-55818-watcher"></span>


</div>


<h2>Story #55818</h2>

<div class="issue status-9 priority-2 closed child details">
  

  

<div class="subject">
<div><p><a href="55813.html" class="issue status-9 priority-2 closed parent">Epic #55813</a>: Access Control Lists</p><div><h3>Configurable NodeType constraints</h3></div></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-09" title="2014-02-09 16:57">over 1 year</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-03-24" title="2014-03-24 18:36">over 1 year</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Closed</td>
    <th class="start-date">Start date:</th><td class="start-date">2014-02-09</td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Should have</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent">0%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">-</td>
    
    <th class="spent-time">Spent time:</th>
    <td class="spent-time">-</td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version">-</td>
    
</tr>

<tr><th>Story points</th><td>-</td></tr><tr><th>Velocity based estimate</th><td>-</td></tr>
</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>It's currently not possible to restrict NodeTypes other than enabling/disabling them globally</p>


	<a name="TYPO3-CMS"></a>
<h2 >TYPO3 CMS<a href="#TYPO3-CMS" class="wiki-anchor">&para;</a></h2>


	<p>In TYPO3 CMS page and content type permissions are configured separately:</p>


	<p><img src="../attachments/download/26022.png" alt="" /></p>


	<p><img src="../attachments/download/26023.png" alt="" /></p>


	<p>- Blacklist for content types (everything else is configured with whitelists)<br />- Very basic, it's not possible to define more complex rules (e.g. constraints)</p>


	<p>(to be continued)</p>
  </div>

<div class="attachments">

<p><a href="../attachments/download/26022/ACL_Page_types.png" class="icon icon-attachment">ACL_Page_types.png</a>  
  
  <span class="size">(18.7 kB)</span>
  
  
    <span class="author">Bastian Waidelich, 2014-02-09 16:57</span>
  
  </p>

<p><a href="../attachments/download/26023/ACL_Content_types.png" class="icon icon-attachment">ACL_Content_types.png</a>  
  
  <span class="size">(29 kB)</span>
  
  
    <span class="author">Bastian Waidelich, 2014-02-09 16:57</span>
  
  </p>

</div>








</div>




<div id="history">
<h3>History</h3>

  <div id="change-203510" class="journal has-notes">
    <h4><a href="55818.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-11" title="2014-02-11 20:33">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-203510-notes"><ul>
	<li>In CMS we've the possibility for using ExplicitAllow for the content types (whitelist), that should be the default in Neos (DENY should still be possible too though, like in the security framework)</li>
		<li>NodeTypes have to be 'globally available' to enable the possibility to link between sites, but should only be visible / possible to create if allowed in current context</li>
		<li>Permissions should not only be applied on create, but also on paste / move</li>
		<li>The permissions of a NodeType apply to a context like nodepath, parent node type and maybe even content dimension</li>
		<li>Create already has support for min / max occurence of a node of type x in a collection. This should still be available in the schema but is imho a nice to have to be fully functional</li>
	</ul></div>
  </div>
  

  <div id="change-205033" class="journal has-details">
    <h4><a href="55818.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-24" title="2014-02-24 11:19">over 1 year</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Assigned To</strong> set to <i>Rens Admiraal</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-205036" class="journal has-notes">
    <h4><a href="55818.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-24" title="2014-02-24 11:38">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205036-notes"><a name="Goals-for-v1"></a>
<h2 >Goals for v1<a href="#Goals-for-v1" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>Extend <strong>NodeTypes.yaml</strong> schema for (dis)allowing child node types</li>
		<li>NodeType constraints are global! (not per site)</li>
		<li>NodeType constraints only limit the allowed child node types for the direct child (not recursive)</li>
	</ul>


	<p>To be discussed:</p>


	<ul>
	<li>Required/minimum amount of child nodes is not covered by constraints, but will be implemented separately (e.g. via an "defaultChildNodes" or "autoCreateChildNodes" configuration)</li>
		<li>v1 does not restrict the allowed number of child nodes!?</li>
		<li>how should constraints be communicated to the client (JS)? Ajax / schema / encoded in the markup?</li>
	</ul>


	<a name="Example"></a>
<h3 >Example<a href="#Example" class="wiki-anchor">&para;</a></h3>


<pre>
<code class="yaml syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="key"><span class="delimiter">'</span><span class="content">Acme.Blog:Post</span><span class="delimiter">'</span></span>:
<span class="line-numbers"> 2</span>  <span class="key">superTypes</span>: <span class="string"><span class="content">['TYPO3.Neos:Page']</span></span>
<span class="line-numbers"> 3</span>  <span class="key">disallowedChildNodeTypes</span>: <span class="string"><span class="content">[ ‘TYPO3.Neos:Document’ ]</span></span>
<span class="line-numbers"> 4</span>  <span class="key">structure</span>:
<span class="line-numbers"> 5</span>      <span class="key">teaser</span>:
<span class="line-numbers"> 6</span>        <span class="key">type</span>: <span class="string"><span class="content">‘Acme.Blog:Teaser’</span></span>
<span class="line-numbers"> 7</span>        <span class="key">properties</span>:
<span class="line-numbers"> 8</span>          <span class="key">title</span>: <span class="string"><span class="content">‘Overwrite default title’</span></span>
<span class="line-numbers"> 9</span>      <span class="key"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>:
<span class="line-numbers"><strong>10</strong></span>        <span class="key">type</span>: <span class="string"><span class="content">collection</span></span>
<span class="line-numbers">11</span>        <span class="key">allowedChildNodeTypes</span>: <span class="string"><span class="content">[‘TYPO3.Neos.NodeTypes:Content’]</span></span>
<span class="line-numbers">12</span>        <span class="key">disallowedChildNodeTypes</span>: <span class="string"><span class="content">[‘Acme.Blog:Post’, ‘Acme.Blog:Comment’]</span></span>
<span class="line-numbers">13</span>      <span class="key"><span class="delimiter">'</span><span class="content">comments</span><span class="delimiter">'</span></span>:
<span class="line-numbers">14</span>        <span class="key">type</span>: <span class="string"><span class="content">collection</span></span>
<span class="line-numbers">15</span>        <span class="key">allowedChildNodeTypes</span>: <span class="string"><span class="content">[‘Acme.Blog:Comment’]</span></span>
</span></code><br /></pre>

	<a name="API"></a>
<h2 >API<a href="#API" class="wiki-anchor">&para;</a></h2>


	<p>We need a simple, extensible API that acts as central authority for node type constraints, for example:<br /><pre>
<code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>  <span class="comment">/**</span>
<span class="line-numbers">2</span><span class="comment">   * @param NodeInterface $parentNode The parent node for the new node to be created (can be a NoteTemplate, too)</span>
<span class="line-numbers">3</span><span class="comment">   * @param string $propertyName The property for which the new node is created (e.g. &quot;main&quot; or &quot;comments&quot;)</span>
<span class="line-numbers">4</span><span class="comment">   * @return array An expanded list of all allowed node types for the given context (e.g. array('Acme.Blog:Comment’, 'Acme.Blog:SpecialComment’))</span>
<span class="line-numbers">5</span><span class="comment">   */</span>
<span class="line-numbers">6</span>  <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getAllowedNodeTypes</span>(<span class="constant">NodeInterface</span> <span class="local-variable">$parentNode</span>, <span class="local-variable">$propertyName</span>);
</span></code><br /></pre></p>


	<p>See <a class="external" href="../../external.html?link=https://docs.google.com/document/d/1RTyFUJ-8r4VuXY2Iq8iLEx9TxpxmAYUg-rzyqSyg7b8/edit#heading=h.fzfxfwcguiic">https://docs.google.com/document/d/1RTyFUJ-8r4VuXY2Iq8iLEx9TxpxmAYUg-rzyqSyg7b8/edit#heading=h.fzfxfwcguiic</a> for more ideas</p></div>
  </div>
  

  <div id="change-205389" class="journal has-notes">
    <h4><a href="55818.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-26" title="2014-02-26 09:34">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205389-notes"><p>Some more thoughts and a first list of tasks. Note that this is just about the global nodetype structure. The possible structure of nodes in the full CR that is, not site specific.<br />If the nodetype constraints over different sites defer, then the integrator should create specific node type declarations (with unique names) for different sites. This is because having constraints can otherwise cause major issues if we want to support copying nodes between sites for example.</p>


	<p>A possible solution to support 'sharing' of nodetypes could be:</p>


	<ul>
	<li>Create the most basic nodetype in 1 site, and extend it in the other site</li>
		<li>Create a 'boilerplate' package holding the common properties, and extend the nodetype in every site package where it's needed</li>
	</ul>


	<p>Some thoughts:</p>


	<ul>
	<li>When we will add features like min / max we can extend this schema to support an array of string values or an array with named indexes like:</li>
	</ul>


<pre>
  'comments':
    type: collection
    allowedChildNodeTypes:
      ‘Acme.Blog:Comment’:
        minOccurences: 1
        maxOccurences: 2
</pre>

	<ul>
	<li>The node constraints are role, and not user specific</li>
		<li>The vie schema should be cached with a cache identifier based on all roles assigned to the current user</li>
		<li>Same for the NodeType Schema</li>
	</ul>


	<p>Step 1</p>


	<ul>
	<li>Change the schema builder to be fully tested &#38; using the specific node type constraint instead of just the global "everything is allowed" constraints</li>
		<li>Cache the schema's based on user roles</li>
		<li>Group the calls to the server as much as possible (now multiple calls to the server are done before storing the data in resource cache, this can be combined which will prevent further performance loss if the usage becomes more complex like with adding the constraints)</li>
		<li>Currently the resource cache caches whatever it receives. This should be changed to cache json responses only</li>
	</ul>


	<p>Step 2</p>


	<ul>
	<li>Update CreateJS to latest (stable) version as it's releases in the meantime (we're now running on pre-alpha :p )</li>
		<li>Make sure the collection widgets in the CreateJS implementation actually handle the updated schema constraints (this should be reflected in the new element wizard attached to the content element handles)</li>
		<li>Update the structure panel 'insert new element' wizard to use the same constraints</li>
		<li>Update the Navigate component 'insert new node' wizard for inserting documents</li>
	</ul></div>
  </div>
  

  <div id="change-205417" class="journal has-notes">
    <h4><a href="55818.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-26" title="2014-02-26 11:03">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205417-notes"><p>Rens Admiraal wrote:</p>


	<p>Hi Rens,</p>


	<p>thanks for the write-up!</p>


<blockquote>

	<ul>
	<li>The node constraints are role, and not user specific</li>
	</ul>


</blockquote>

	<p>I thought the plan was that these node type constraints should be <strong>global</strong> (not site- or user/role specific). We said that it's usually not a security related issue, but the structural constraints of a web design.<br />The NodeTypes a role is allowed to use should be restrictable.</p></div>
  </div>
  

  <div id="change-205430" class="journal has-notes">
    <h4><a href="55818.html#note-6" class="journal-link">#6</a>
    
    <a name="note-6"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-26" title="2014-02-26 11:45">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205430-notes"><p>Hey Bastian,</p>


	<p>Ack to having the node type constraints global, but the schema will not be equal to all user. A user which is only allowed to use nodetypes A, B and C will not have the possibility to add D and E which has to be reflected in the VIE schema for CreateJS</p></div>
  </div>
  

  <div id="change-205478" class="journal has-notes">
    <h4><a href="55818.html#note-7" class="journal-link">#7</a>
    
    <a name="note-7"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-26" title="2014-02-26 13:56">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205478-notes"><p>just discussed it with Aske and, we need to cover the following tasks too:</p>


	<ul>
	<li>Check the structure before allowing creation / pasting server side in the NodeController, and give a notification to the user if it's not allowed</li>
		<li>Low prio: add min / max occurences of nodetypes in a collection (this is already supported in CreateJS, but would've to be added to the navigate component / server side)</li>
		<li>Nice to have: defaultChildNodes definition in the yaml which would automatically create a set of childNodes on node creation (differs from childNodes feature we have now as it would not be enforced childNodes, but just initial childNodes that could be removed by the user)</li>
	</ul>


	<p>Sideways related: we might need to make sure a nodetype could be of type 'collection' and be added using the content management module. Currently this is only possible if the collection is wrapped by another nodetype (like a multiColumn with childNodes of type collection)</p></div>
  </div>
  

  <div id="change-205720" class="journal has-notes">
    <h4><a href="55818.html#note-8" class="journal-link">#8</a>
    
    <a name="note-8"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-27" title="2014-02-27 17:54">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205720-notes"><p>Hey everybody,</p>


	<p>I like very much what I have read.</p>


	<p>Overally I just have one topic which I have not seen here in the thread:</p>


	<ul>
	<li>For Implementation Step 1, I think it is crucial to have a command-line tool (or a Neos backend module, whatever) which allows to <strong>check if the CR is currently in sync with the constraints</strong>; and (maybe) can do a best-effort to correct errors. This is because the integrator during development will change the constraints quite rapidly and thus the CR might not be in sync anymore; so he might get not what he expects. We need to show him "a way out of this".</li>
	</ul>


	<p>Now follow some nitpick comments :-)</p>


	<a name="Comments-for-Bastians-Post"></a>
<h2 >Comments for Bastian's Post<a href="#Comments-for-Bastians-Post" class="wiki-anchor">&para;</a></h2>


<blockquote>

	<ul>
	<li>NodeType constraints are global! (not per site)</li>
	</ul>


</blockquote>

	<p>I think we can live with this; I am not sure what to do "per-site". In the long run I could imagine that we solve "per-site" configuration directly in the Flow Configuration Manager (using something like "scopes" or so). We'll see.</p>


<blockquote>

	<ul>
	<li>NodeType constraints only limit the allowed child node types for the direct child (not recursive)</li>
	</ul>


</blockquote>

	<p>While I think this works in many cases, this will <strong>definitely</strong> give problems when working with <code>ContentCollection</code>. So basically I think it must not be recursive EXCEPT that we need to be able to define what's inside a nested, named content collection. That has been taken into account in the example, though, so I think you thought about this as well.</p>


<blockquote>

To be discussed:
	<ul>
	<li>Required/minimum amount of child nodes is not covered by constraints, but will be implemented separately (e.g. via an "defaultChildNodes" or "autoCreateChildNodes" configuration)</li>
		<li>v1 does not restrict the allowed number of child nodes!?</li>
	</ul>


</blockquote>

	<p>ACK. I think that's fine.</p>


<blockquote>

	<ul>
	<li>how should constraints be communicated to the client (JS)? Ajax / schema / encoded in the markup?</li>
	</ul>


</blockquote>

	<p>AJAX or Schema, definitely NOT encoded in markup I'd say.</p>


<blockquote>

	<a name="Example"></a>
<h3 >Example<a href="#Example" class="wiki-anchor">&para;</a></h3>


	<p>[...]</p>


</blockquote>

	<p>overally looks good!</p>


<blockquote>

	<a name="API"></a>
<h2 >API<a href="#API" class="wiki-anchor">&para;</a></h2>


	<p>We need a simple, extensible API that acts as central authority for node type constraints, for example:<br />[...]</p>


</blockquote>

	<p>I think that's not "propertyName" here, but $contentCollectionName or the like. Because it's not a node-proeprty but a subnode of type ContentCollection.</p>


	<a name="Comments-for-Renss-Post"></a>
<h2 >Comments for Rens's Post<a href="#Comments-for-Renss-Post" class="wiki-anchor">&para;</a></h2>


	<p>Rens Admiraal wrote:</p>


<blockquote>

	<p>Some more thoughts and a first list of tasks. Note that this is just about the global nodetype structure. The possible structure of nodes in the full CR that is, not site specific.<br />If the nodetype constraints over different sites defer, then the integrator should create specific node type declarations (with unique names) for different sites. This is because having constraints can otherwise cause major issues if we want to support copying nodes between sites for example.</p>


</blockquote>

	<p>I agree; I think it's a rather esoteric edge-case to have <strong>completely different</strong> sites with different node types etc in the same Neos instance; so we do not need to focus on that I'd say now.</p>


<blockquote>

	<p>A possible solution to support 'sharing' of nodetypes could be:</p>


</blockquote>

	<p>... I think we don't need to focus on this now, I'd say :)</p>


<blockquote>

	<ul>
	<li>When we will add features like min / max we can extend this schema to support an array of string values or an array with named indexes like:</li>
	</ul>


</blockquote>

	<p>+2, I like.</p>


<blockquote>

	<p>just discussed it with Aske and, we need to cover the following tasks too:</p>


	<ul>
	<li>Check the structure before allowing creation / pasting server side in the NodeController, and give a notification to the user if it's not allowed</li>
	</ul>


</blockquote>

	<p>ACK</p>


<blockquote>

	<p>Sideways related: we might need to make sure a nodetype could be of type 'collection' and be added using the content management module. Currently this is only possible if the collection is wrapped by another nodetype (like a multiColumn with childNodes of type collection)</p>


</blockquote>

	<p>I don't understand this yet, but we can discuss that in person soon :)</p>


	<a name="Conclusion"></a>
<h2 >Conclusion<a href="#Conclusion" class="wiki-anchor">&para;</a></h2>


	<p>Great work everybody involved!<br />Hear you soon,<br />Sebastian</p></div>
  </div>
  

  <div id="change-205725" class="journal has-notes">
    <h4><a href="55818.html#note-9" class="journal-link">#9</a>
    
    <a name="note-9"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-27" title="2014-02-27 18:08">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205725-notes"><p>Sebastian Kurfuerst wrote:</p>


	<p>Thanks for your comments!</p>


<blockquote>

	<ul>
	<li>For Implementation Step 1, I think it is crucial to have a command-line tool (or a Neos backend module, whatever) which allows to <strong>check if the CR is currently in sync with the constraints</strong>; and (maybe) can do a best-effort to correct errors. This is because the integrator during development will change the constraints quite rapidly and thus the CR might not be in sync anymore; so he might get not what he expects. We need to show him "a way out of this".</li>
	</ul>


</blockquote>

	<p>Good point, we'll surely need that! (for the record: the logic should not reside in the command controller so that we can reuse it from other places, e.g. UI at some point)</p>


<blockquote><blockquote>

	<ul>
	<li>NodeType constraints are global! (not per site)</li>
	</ul>


</blockquote>

	<p>I think we can live with this; I am not sure what to do "per-site". In the long run I could imagine that we solve "per-site" configuration directly in the Flow Configuration Manager (using something like "scopes" or so). We'll see.</p>


</blockquote>

	<p>Yes, we talked about these "context-configuration-overlays" and came to the conclusion that we want to avoid it if possible (for now). Some configuration must not be scope-specific (such as reflection-related things) and for others it might get very confusing. For node type constraints I don't think that's an big issue though as you can work around this with custom node types.</p>


<blockquote><blockquote>

	<ul>
	<li>NodeType constraints only limit the allowed child node types for the direct child (not recursive)</li>
	</ul>


</blockquote></blockquote>

<blockquote>

	<p>While I think this works in many cases, this will <strong>definitely</strong> give problems when working with <code>ContentCollection</code> [...]</p>


</blockquote>

	<p>True, I always forget this point! ContentCollections need some special handling</p>


<blockquote><blockquote>

	<p>We need a simple, extensible API that acts as central authority for node type constraints, for example: [...]</p>


</blockquote>

	<p>I think that's not "propertyName" here, but $contentCollectionName or the like. Because it's not a node-proeprty but a subnode of type ContentCollection.</p>


</blockquote>

	<p>Right, I mixed that up. Actually we once said it should accept the target <strong>path</strong></p></div>
  </div>
  

  <div id="change-205744" class="journal has-notes">
    <h4><a href="55818.html#note-10" class="journal-link">#10</a>
    
    <a name="note-10"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-27" title="2014-02-27 19:47">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205744-notes"><p>Thanks for the feedback ;-)</p>


	<p>About the ContentCollection... Do you mean that it will be a problem if you set for example the allowedChildNodes on a MultiColumn element, and want to set different constraints for each column? Or something else?</p></div>
  </div>
  

  <div id="change-205804" class="journal has-notes">
    <h4><a href="55818.html#note-11" class="journal-link">#11</a>
    
    <a name="note-11"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/2208">Christian Müller</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-28" title="2014-02-28 07:45">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205804-notes"><p>Regarding the per site stuff, just for later. Why not say that site package NodeTypes are only added for the currently requested site? If you then want to have "global" NodeTypes you put that in a seperate package. Just an idea... Can have lots of side effects of course.</p></div>
  </div>
  

  <div id="change-205812" class="journal has-notes">
    <h4><a href="55818.html#note-12" class="journal-link">#12</a>
    
    <a name="note-12"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3198">Rens Admiraal</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-02-28" title="2014-02-28 09:14">over 1 year</a> ago</h4>

    
    <div class="wiki" id="journal-205812-notes"><p>We thought about that too. But doing so would mean that the constraints describe the structure of nodes that could have a different structure if they're moved to smoother path in the cr. This would mean data loss in current situation (non existing properties are not stored). Also linking between sites will be an issue. And those are just 2 of the things we would run into ;)</p>


	<p>Besides that I think having 1 definition of constraints for the full cr (which is also shared between sites) makes a lot of sense.</p>


	<p>We played around with multi site installs and from that I learned that the only issue is the visibility of node types in the wizards while they shouldn't be for the current site. This is far easier to handle. I also think that explaining an integrator that he should create a separate nodetype for a site when it has a unique structure is straight forward.</p></div>
  </div>
  

  <div id="change-210125" class="journal has-notes has-details">
    <h4><a href="55818.html#note-13" class="journal-link">#13</a>
    
    <a name="note-13"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos-distribution-base/activity?from=2014-03-24" title="2014-03-24 18:36">over 1 year</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-210125-notes"><p>Moved to <a class="external" href="../../external.html?link=https://jira.typo3.org/browse/NEOS-34">https://jira.typo3.org/browse/NEOS-34</a></p>


	<p>@Rens you don't have a jira account yet, so I couldn't assign this to you. Will do tomorrow!</p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-55818-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/55818.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="55818.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/55818 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:17:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
