<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/45290 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:06:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Bug #45290: Body arguments should not be merged before property mapping takes place - TYPO3.Flow - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

#header #right-area, #header #right-area h1, #header #right-area a {
  color:transparent;
}

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/45290.atom" rel="alternate" title="TYPO3.Flow - Bug #45290: Body arguments should not be merged before property mapping takes place" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 current sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="background-image:url(../headerimages/16.jpg);">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/search" accesskey="4" style="color:transparent">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>TYPO3.Flow</h1>
        <div id="quicklinks"></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="level-1 current sorting-0">TYPO3 Flow Base Distribution</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-eel" class="level-2 sorting-0">TYPO3.Eel</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="level-2 current sorting-0">TYPO3.Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-fluid" class="level-2 sorting-0">TYPO3.Fluid</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-kickstart" class="level-2 sorting-0">TYPO3.Kickstart</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-welcome" class="level-2 sorting-0">TYPO3.Welcome</a><a href="../../external.html?link=https://forge.typo3.org/projects/packages" class="level-1 sorting-10">Packages</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-apps" class="level-1 sorting-30">Applications</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues/report">Summary</a><br />







<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=375" class="query">Open documentation issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=204" class="query">Recently modified</a>



  
    <div id="watchers">
      

<h3>Watchers (1)</h3>

<ul><li><a href="../../external.html?link=https://forge.typo3.org/users/4764">Alexander Berl</a></li></ul>

    </div>
  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-45290-watcher"></span>


</div>


<h2>Bug #45290</h2>

<div class="issue status-9 priority-2 closed child details">
  

  

<div class="subject">
<div><p><a href="45088.html" class="issue status-7 priority-2 closed parent">Work Package #45088</a>: Improved REST support</p><div><h3>Body arguments should not be merged before property mapping takes place</h3></div></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-02-08" title="2013-02-08 17:05">over 2 years</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-09-23" title="2013-09-23 14:01">almost 2 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Closed</td>
    <th class="start-date">Start date:</th><td class="start-date">2013-02-08</td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Should have</td>
    <th class="due-date">Due date:</th><td class="due-date">2013-04-13</td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="pourcent">100%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">Http</td>
    
    <th></th>
    <td></td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version">-</td>
    
</tr>
<tr>
	<th>PHP Version:</th><td></td>
	<th>Complexity:</th><td></td>
</tr>
<tr>
	<th>Has patch:</th><td>No</td>
	<th>Affected Flow version:</th><td>Git master</td>
</tr>


</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Currently <strong>body</strong> and <strong>POST</strong> arguments are merged with <strong>GET</strong> arguments in <code>Http\Request::__construct()</code>.<br />Instead the merging should happen after routing took place in order to know more about the affected arguments.</p>


	<p>Now, if you invoke a PUT request to <a class="external" href="../../external.html?link=http://localhost/products/product-1">http://localhost/products/product-1</a> with a body of<br /><pre>
<code class="json syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>{
<span class="line-numbers">2</span>  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>: {
<span class="line-numbers">3</span>    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">new title</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">4</span>  }
<span class="line-numbers">5</span>}
</span></code><br /></pre></p>


	<p><strong>GET</strong> arguments:<br /><pre>
<code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="predefined">array</span>(<span class="string"><span class="delimiter">'</span><span class="content">product</span><span class="delimiter">'</span></span> =&gt; <span class="string"><span class="delimiter">'</span><span class="content">&lt;uuid of product-1&gt;</span><span class="delimiter">'</span></span>)
</span></code><br /></pre></p>


	<p><strong>Body</strong> arguments:<br /><pre>
<code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="predefined">array</span>(<span class="string"><span class="delimiter">'</span><span class="content">product</span><span class="delimiter">'</span></span> =&gt; <span class="predefined">array</span>(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span> =&gt; <span class="string"><span class="delimiter">'</span><span class="content">new title</span><span class="delimiter">'</span></span>));
</span></code><br /></pre></p>


	<p>Obviously <code>\Http\Request::buildUnifiedArguments()</code> can't properly merge those and - as a result - ignores the body arguments.</p>


	<p>Instead the property mapper should probably fetch body arguments separately before calling the action (probably in <code>ActionController::mapRequestArgumentsToControllerArguments()</code>)</p>
  </div>








<hr />
<div id="relations">
<div class="contextual">

</div>

<p><strong>Related issues</strong></p>


<form>
<table class="list issues">

<tr class="issue hascontextmenu" id="relation-7964">
<td class="checkbox"><input name="ids[]" type="checkbox" value="44712" /></td>
<td class="subject">related to 
    TYPO3.Flow - 
    <a href="44712.html" class="issue status-2 priority-2">Task #44712</a>: Decouple Argument-Building in the HTTP-Request-Constructor
</td>
<td class="status">Accepted</td>
<td class="start_date">2013-01-22</td>
<td class="due_date"></td>
<td class="buttons"></td>
</tr>

</table>
</form>


<form action="../../external.html?link=https://forge.typo3.org/issues/45290/relations" id="new-relation-form" method="post" onsubmit="new Ajax.Request('/issues/45290/relations', {asynchronous:true, evalScripts:true, method:'post', onComplete:function(request){Form.Element.focus('relation_issue_to_id');}, parameters:Form.serialize(this)}); return false;" style="display: none;"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="IjgAk+sryuS7AAkPn7/ITUV652f6cwFBHN6GNTvW7o8=" /></div>


<p><select id="relation_relation_type" name="relation[relation_type]" onchange="setPredecessorFieldsVisibility();"><option value="relates">related to</option>
<option value="duplicates">duplicates</option>
<option value="duplicated">duplicated by</option>
<option value="blocks">blocks</option>
<option value="blocked">blocked by</option>
<option value="precedes">precedes</option>
<option value="follows">follows</option></select>
Issue #<input id="relation_issue_to_id" name="relation[issue_to_id]" size="10" type="text" />
<span id="predecessor_fields" style="display:none;">
Delay: <input id="relation_delay" name="relation[delay]" size="3" type="text" /> days
</span>
<input name="commit" type="submit" value="Add" />
<a href="#" onclick="Element.toggle('new-relation-form'); this.blur(); return false;">Cancel</a>
</p>

<div id="related_issue_candidates" class="autocomplete"></div>
<script type="text/javascript">
//<![CDATA[
observeRelatedIssueField('/issues/auto_complete?id=45290&amp;project_id=package-typo3-flow')
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>

</div>


</div>




<div id="history">
<h3>History</h3>

  <div id="change-152191" class="journal has-details">
    <h4><a href="45290.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-02-22" title="2013-02-22 10:35">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Parent task</strong> set to <i>#45088</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-157410" class="journal has-details">
    <h4><a href="45290.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3326">Aske Ertmann</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-03-28" title="2013-03-28 16:21">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Parent task</strong> deleted (<strike><i>#45088</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-157417" class="journal has-details">
    <h4><a href="45290.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/3326">Aske Ertmann</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-03-28" title="2013-03-28 16:22">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Parent task</strong> set to <i>#45088</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-157837" class="journal has-details">
    <h4><a href="45290.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-02" title="2013-04-02 13:17">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Due date</strong> set to <i>2013-04-13</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-158040" class="journal has-notes has-details">
    <h4><a href="45290.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/36798">Gerrit Code Review</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-04" title="2013-04-04 15:45">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Under Review</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-158040-notes"><p>Patch set 1 for branch <strong>master</strong> has been pushed to the review server.<br />It is available at <a class="external" href="../../external.html?link=https://review.typo3.org/19556">https://review.typo3.org/19556</a></p></div>
  </div>
  

  <div id="change-158811" class="journal has-notes">
    <h4><a href="45290.html#note-6" class="journal-link">#6</a>
    
    <a name="note-6"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/36798">Gerrit Code Review</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-08" title="2013-04-08 12:36">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-158811-notes"><p>Patch set 2 for branch <strong>master</strong> has been pushed to the review server.<br />It is available at <a class="external" href="../../external.html?link=https://review.typo3.org/19556">https://review.typo3.org/19556</a></p></div>
  </div>
  

  <div id="change-158812" class="journal has-notes">
    <h4><a href="45290.html#note-7" class="journal-link">#7</a>
    
    <a name="note-7"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-08" title="2013-04-08 12:37">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-158812-notes"><p>Here is a little test package that demonstrates the "bug": <a class="external" href="../../external.html?link=https://github.com/bwaidelich/Wwwision.ArgumentTest">https://github.com/bwaidelich/Wwwision.ArgumentTest</a></p></div>
  </div>
  

  <div id="change-161045" class="journal has-notes has-details">
    <h4><a href="45290.html#note-8" class="journal-link">#8</a>
    
    <a name="note-8"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-24" title="2013-04-24 10:55">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>% Done</strong> changed from <i>0</i> to <i>30</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-161045-notes"><p>This one is a bit tricky, especially if we want to resolve it in a API-backwards-compatible (aka BC) way.<br />I wrote several spikes and prototypes but I always either broke the API or resulted with a overcomplex architecture..<br />Here are my findings:</p>


	<a name="Current-request-handling"></a>
<h2 >Current request handling<a href="#Current-request-handling" class="wiki-anchor">&para;</a></h2>


	<ol>
	<li>The <strong>RequestHandler</strong> builds the <strong>HttpRequest<sup><a href="#fn1">1</a></sup></strong> calling <strong><em>Request::createFromEnvironment()</em></strong></li>
		<li>The <strong>HttpRequest</strong> merges <strong>$_GET</strong>, <strong>$_POST</strong>, <strong>$_FILES</strong> with the <strong>bodyArguments<sup><a href="#fn2">2</a></sup></strong> and unifying them into <strong>arguments</strong></li>
		<li>The <strong>Router</strong> calls <strong><em>HttpRequest::createActionRequest()</em></strong> and passes all <strong>arguments</strong> to the created <strong>ActionRequest</strong></li>
		<li>After a route was found the <strong>Router</strong> then merges the arguments of the <strong>ActionRequest</strong> with the <strong>$matchResults<sup><a href="#fn3">3</a></sup></strong></li>
		<li>The <strong>AbstractController</strong> maps ActionRequest arguments to the parameters of the action to be called (in <strong><em>AbstractController::mapRequestArgumentsToControllerArguments()</em></strong>)</li>
	</ol>


	<a name="Problems"></a>
<h2 >Problems<a href="#Problems" class="wiki-anchor">&para;</a></h2>


	<p>Here are a couple of "issues" we have with the current sequence:</p>


	<ul>
	<li>The <strong>HttpRequest</strong> always merges all arguments and parses the request body in its constructor even if they might not be needed (this can cost performance &#38; memory)</li>
		<li>The parsing of bodyArguments is hard-coded and only supports basic XML, JSON &#38; urlencoded strings.The <strong>HttpRequest</strong> is built very early (e.g. before <acronym title="Dependency Injection">DI</acronym> is available), so we can't easily inject a service that could take over that job. Currently, if you use your custom mediatype (which is encouraged in REST services for example), you'll have to parse the request body yourself somehow and in the worst case the HttpRequest trips over your format when it tries to parse it in <strong><em>Request::decodeBodyArguments()</em></strong></li>
		<li>Currently there is no way to separately retrieve GET/POST and <strong>bodyArguments</strong> from the HttpRequest, resulting in the very problem described in this ticket</li>
	</ul>


	<a name="Long-term"></a>
<h2 >Long term<a href="#Long-term" class="wiki-anchor">&para;</a></h2>


	<p>Christopher came up with the idea to refactor the request handling into some kind of <strong>chain</strong>: Each component of the chain would take a <strong>Request</strong> and <strong>Response</strong> and could apply filters and such on them (visitor pattern).<br />This would also greatly decouple our MVC architecture from the application (you could define custom chains that end up somewhere else than in an ActionRequest, and you could replace single components – like the Router – with a simpler/better suited implementation for certain requests)</p>


	<p>While I really like Christophers idea, I can't exactly imagine how that would work out in practice and whether it would kill the BC cow.. In any case we probably need an intermediate step really soon. So that would be my suggestion:</p>


	<a name="Short-term"></a>
<h2 >Short term<a href="#Short-term" class="wiki-anchor">&para;</a></h2>


	<p>I tried to come up with some steps that would solve most of our current issues while keeping the API <strong>kind of</strong> backwards-compatible:</p>


	<ul>
	<li>In general I think the HttpRequest should be less smart and map "1:1" to what exists in the real HTTP request</li>
		<li>Keep <strong><em>Request::getArguments()</em></strong> (which is public API) but let it only return merged <strong>_GET</strong> and <strong>_POST</strong> arguments, not the parsed <strong>bodyArguments</strong> (I'm not sure about <strong>_FILES</strong>, they can be merged too I guess).
	<ul>
	<li>In addition the HttpRequest could store <strong>_GET</strong> and <strong>_POST</strong> separately so that the merging only needs to be done when needed (the first time) and that <strong>_GET</strong> and <strong>_POST</strong> variables can be accessed separately if needed</li>
	</ul>
	</li>
		<li><strong><em>HttpRequest::createActionRequest()</em></strong> only passes itself to the constructor of <strong>ActionRequest</strong> (this is already the case) and does not copy it's arguments to the <strong>ActionRequest</strong></li>
		<li>The router passes the <strong>$matchResults</strong> to the <strong>ActionRequest</strong> (no merging, the ActionRequest only contains the routing values)
	<ul>
	<li>Maybe it would make sense to rename <strong><em>ActionRequest::arguments</em></strong> keeping the old getters/setters as deprecated for a while) to something that distinguish them from the HTTP arguments.</li>
		<li>We could keep <strong><em>ActionRequest::getArguments()</em></strong> BC by returning a merged result of $this->arguments &#38;&#38; $this->httpRequest->getArguments()</li>
	</ul>
	</li>
		<li>The <strong>ActionController</strong> would do the heavy work and merge <strong>required</strong> arguments in <strong><em>AbstractController::mapRequestArgumentsToControllerArguments()</em></strong>
	<ul>
	<li>This is also the time where the <strong>bodyArguments</strong> are parsed (preferably by some extensible service)</li>
	</ul></li>
	</ul>


	<a name="Breaking-changes"></a>
<h3 >Breaking changes<a href="#Breaking-changes" class="wiki-anchor">&para;</a></h3>


	<p>The above path would result in a couple of breaking changes, but only for rare cases as far as I can see:</p>


	<ul>
	<li>arguments returned from <strong><em>Request::getArguments()</em></strong> would <strong>not</strong> contain the <strong>bodyArguments</strong> (you could use the above mentioned service to parse those)</li>
		<li>If you override <strong><em>AbstractController::mapRequestArgumentsToControllerArguments()</em></strong> you probably have to adjust your implementation slightly</li>
	</ul>


	<a name="Footnotes"></a>
<h2 >Footnotes<a href="#Footnotes" class="wiki-anchor">&para;</a></h2>


	<p id="fn1" class="footnote"><sup>1</sup> The class of the HTTP request is actually called <em>Request</em> – I call it <em>HttpRequest</em> here to avoid confusion with the <em>ActionRequest</em></p>


	<p id="fn2" class="footnote"><sup>2</sup> With <strong>bodyArguments</strong> we refer to everything that is part of the request body and has not been mapped to _POST or _FILES by PHP – e.g. the payload in a REST request.</p>


	<p id="fn3" class="footnote"><sup>3</sup> <strong>matchResults</strong> are the results of a matched route which is an array of all <strong>defaults</strong> and the <strong>uriPattern</strong> values of the route</p></div>
  </div>
  

  <div id="change-161660" class="journal has-notes">
    <h4><a href="45290.html#note-9" class="journal-link">#9</a>
    
    <a name="note-9"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4764">Alexander Berl</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-29" title="2013-04-29 03:09">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-161660-notes"><p>Hi Bastian,</p>


	<p>I like the general idea and here is some input from my side:</p>


	<ul>
	<li>Why does the <strong>HttpRequest</strong> need to know how to create an <strong>ActionRequest</strong>? This is IMO <em>bad coupling</em> and the creation of an <strong>ActionRequest</strong> should be moved to the <strong>Router</strong>.</li>
		<li>The <strong>Router</strong> is already capable of full DI, so it would be easy to inject argument mapping services in there, which uses the routing matches and <strong>HttpRequest</strong> arguments + body as sources</li>
		<li>The <strong>ActionRequest</strong> in turn can then just get the raw arguments injected</li>
		<li>Rest can stay as is, ie. <strong>AbstractController:mapRequestArgumentsToControllerArguments()</strong> would stay unchanged and really only do what it says - map raw request arguments to full blown Controller arguments (objects), without caring where they come from</li>
	</ul>


	<p>My point is that it would be even <ins><em>more BC</em></ins> as really only <strong>HttpRequest</strong> <em>becomes a little bit dumber</em>, it <ins><em>keeps the concerns better seperated</em></ins> (decouple <strong>Http</strong> from <strong>Mvc</strong>, keep argument merging in <strong>Routing</strong>), plus it is quite handy to have a central place outside the current Controller where you can just access all raw action arguments without having to care if they came from routing, GET/POST/FILES, request body or whatever. A good example is creating caching identifiers from the arguments, where you don't want to deal with <strong>Entity Objects</strong> and the likes. The <strong>ActionRequest</strong> is IMO the best point to have those available.</p></div>
  </div>
  

  <div id="change-163353" class="journal has-notes">
    <h4><a href="45290.html#note-10" class="journal-link">#10</a>
    
    <a name="note-10"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-06" title="2013-05-06 12:09">about 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-163353-notes"><p>Alexander Berl wrote:</p>


	<p>Hi Alexander,</p>


	<p>thanks for your feedback, it's appreciated!</p>


<blockquote>

	<ul>
	<li>Why does the <strong>HttpRequest</strong> need to know how to create an <strong>ActionRequest</strong>? This is IMO <em>bad coupling</em> and the creation of an <strong>ActionRequest</strong> should be moved to the <strong>Router</strong>.</li>
	</ul>


</blockquote>

	<p>Correct! We already agreed to remove <strong>HttpRequest::createActionRequest()</strong> – luckily that's not part of the public API</p>


<blockquote>

	<ul>
	<li>The <strong>Router</strong> is already capable of full DI, so it would be easy to inject argument mapping services in there, which uses the routing matches and <strong>HttpRequest</strong> arguments + body as sources</li>
	</ul>


</blockquote>

	<p>Mh. I'm not sure that it's the routers job to do extended argument mapping but I'll give it a try</p>


<blockquote>

	<ul>
	<li>The <strong>ActionRequest</strong> in turn can then just get the raw arguments injected</li>
	</ul>


</blockquote>

	<p>Right. It could also fetch the arguments from the HttpRequest when <strong>accessed the first time</strong>.</p>


<blockquote>

	<ul>
	<li>Rest can stay as is, ie. <strong>AbstractController:mapRequestArgumentsToControllerArguments()</strong> would stay unchanged and really only do what it says - map<br />raw request arguments to full blown Controller arguments (objects), without caring where they come from</li>
	</ul>


</blockquote>

	<p>The thing is: The only way (I can think of) to solve the problem described in this issue is to check the type of an action parameter in order to turn '&lt;UUID&gt;' into array('__identifier' => '&lt;UUID&gt;'). <strong>AbstractController:mapRequestArgumentsToControllerArguments()</strong> is currently the place where this could be done. But I agree that this doesn't feel right as it bloats the controller even more.</p>


<blockquote>

	<p>My point is that it would be even <ins><em>more BC</em></ins> as really only <strong>HttpRequest</strong> <em>becomes a little bit dumber</em>...</p>


</blockquote>

	<p>Exactly my point.</p></div>
  </div>
  

  <div id="change-164116" class="journal has-notes">
    <h4><a href="45290.html#note-11" class="journal-link">#11</a>
    
    <a name="note-11"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4764">Alexander Berl</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-08" title="2013-05-08 14:01">about 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-164116-notes"><p>Ok, I think I get it now. The problem is that you also need the Controller Arguments information to know that a parameter is supposed to be an entity, since the routing might not contain that information (<em>like in the example app where the route part is only a plain dynamic one</em>).</p>


	<p>The easy solution would be to use the <code>IdentityRoutePart</code> for this parameter and supply the <code>objectType</code> explicitly.</p>


	<p>Maybe the problem can be solved differently: Basically, only the information from the controller parameter types is missing in the routing configuration - now that information is normally static for as long as the application code doesn't change (see <code>ActionController::getActionMethodParameters</code>, it is even statically compiled). What if some kind of <em>MvcControllerArgumentMappingService</em> would collect all parameter type information during compile time and add this information to the routing configuration for all parameters that are missing the objectType configuration?</p>


	<p>Only thing that I see that would not work are dynamic controller arguments, but those are normally no entities as the type information is missing unless you do <code>$this->arguments->addNewArgument</code> manually somewhere in your controller.</p></div>
  </div>
  

  <div id="change-166449" class="journal has-details">
    <h4><a href="45290.html#note-12" class="journal-link">#12</a>
    
    <a name="note-12"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-21" title="2013-05-21 13:28">about 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Target version</strong> deleted (<strike><i>2.1</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-183525" class="journal has-notes has-details">
    <h4><a href="45290.html#note-13" class="journal-link">#13</a>
    
    <a name="note-13"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-09-19" title="2013-09-19 16:02">almost 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>% Done</strong> changed from <i>30</i> to <i>100</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-183525-notes"><p>Will be resolved with <a class="external" href="../../external.html?link=https://review.typo3.org/21134/">https://review.typo3.org/21134/</a></p></div>
  </div>
  

  <div id="change-183797" class="journal has-notes has-details">
    <h4><a href="45290.html#note-14" class="journal-link">#14</a>
    
    <a name="note-14"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-09-23" title="2013-09-23 14:01">almost 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Under Review</i> to <i>Closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-183797-notes"><p>See <a href="45293.html" class="issue status-7 priority-2 closed child" title="More flexible parsing of body arguments (Resolved)">#45293</a></p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-45290-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/45290.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="45290.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/45290 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:06:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
