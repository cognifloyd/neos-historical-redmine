<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/45407 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:06:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Bug #45407: charset option for mysql connection is ignored with PHP &lt; 5.3.6 - TYPO3.Flow - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

#header #right-area, #header #right-area h1, #header #right-area a {
  color:transparent;
}

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/45407.atom" rel="alternate" title="TYPO3.Flow - Bug #45407: charset option for mysql connection is ignored with PHP &lt; 5.3.6" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 current sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="background-image:url(../headerimages/16.jpg);">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/search" accesskey="4" style="color:transparent">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>TYPO3.Flow</h1>
        <div id="quicklinks"></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="level-1 current sorting-0">TYPO3 Flow Base Distribution</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-eel" class="level-2 sorting-0">TYPO3.Eel</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="level-2 current sorting-0">TYPO3.Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-fluid" class="level-2 sorting-0">TYPO3.Fluid</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-kickstart" class="level-2 sorting-0">TYPO3.Kickstart</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-welcome" class="level-2 sorting-0">TYPO3.Welcome</a><a href="../../external.html?link=https://forge.typo3.org/projects/packages" class="level-1 sorting-10">Packages</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-apps" class="level-1 sorting-30">Applications</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues/report">Summary</a><br />







<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=375" class="query">Open documentation issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=204" class="query">Recently modified</a>



  
    <div id="watchers">
      

<h3>Watchers (1)</h3>

<ul><li><a href="../../external.html?link=https://forge.typo3.org/users/4014">Daniel Ostmann</a></li></ul>

    </div>
  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-45407-watcher"></span>


</div>


<h2>Bug #45407</h2>

<div class="issue status-9 priority-1 closed details">
  

  

<div class="subject">
<div><h3>charset option for mysql connection is ignored with PHP &lt; 5.3.6</h3></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/37906">Benjamin Albrecht</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-02-12" title="2013-02-12 12:36">over 2 years</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-09-26" title="2013-09-26 10:49">almost 2 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Closed</td>
    <th class="start-date">Start date:</th><td class="start-date">2013-02-12</td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Must have</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/10">Karsten Dambekalns</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent">0%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">Persistence</td>
    
    <th></th>
    <td></td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version">-</td>
    
</tr>
<tr>
	<th>PHP Version:</th><td>5.3</td>
	<th>Complexity:</th><td></td>
</tr>
<tr>
	<th>Has patch:</th><td>No</td>
	<th>Affected Flow version:</th><td>Flow 2.0.0 beta 1</td>
</tr>


</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Hi,</p>


	<p>the configurable charset option for the backed (default "utf8") is ignored with PHP Version < 5.3.6<br />But the systems requirements of Flow 2.0 are PHP 5.3.2<br />(Here is the link to the PHP documentation: <a class="external" href="../../external.html?link=http://php.net/manual/de/ref.pdo-mysql.connection.php">http://php.net/manual/de/ref.pdo-mysql.connection.php</a>)</p>


	<p>There are several implications with this Bug:<br />- Upgrade of PHP Version to 5.3.6 is not possible<br />We are using Debian 6.0 with the latest PHP 5.3 Debian package. This is PHP 5.3.3-7+squeeze14, wich contains 5.3.3 plus Bugfixes and Securityfixes, but not new features, like the pdo_mysql charset support.<br />- If we ignore this bug and writing content into the db only with Flow, there are no wrong character at the frontend / website. But the db contains broken characters. After an update to an new php version or another server, the broken characters are shown at the frontend... (same after upgrading from FLOW3 1.1)</p>


	<p>The mysql driver of doctrine supports "driverOptions" to set something like "SET NAMES utf8", but after this commit and using the native doctrine sources, this is no longer useful... <a class="external" href="../../external.html?link=http://git.typo3.org/FLOW3/Packages/Doctrine.DBAL.git/commitdiff/b231de400af149a7e6a980939b067c6177707e3d">http://git.typo3.org/FLOW3/Packages/Doctrine.DBAL.git/commitdiff/b231de400af149a7e6a980939b067c6177707e3d</a></p>


	<p>Another useful solution could be the "SessionInitialization" of doctrine, but after this commit a great configure option of Flow is removed :-/ <a class="external" href="../../external.html?link=http://git.typo3.org/FLOW3/Packages/TYPO3.FLOW3.git/commit/0636682f3b304c6a63e7b1558d7d32c153c1940f">http://git.typo3.org/FLOW3/Packages/TYPO3.FLOW3.git/commit/0636682f3b304c6a63e7b1558d7d32c153c1940f</a><br />Why?</p>
  </div>









</div>




<div id="history">
<h3>History</h3>

  <div id="change-151466" class="journal has-notes">
    <h4><a href="45407.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/38591">Ottmar Biebersdorf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-02-16" title="2013-02-16 20:39">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-151466-notes"><p>I can confirm this issue for Debian Sqeeze with PHP 5.3.3-7+squeeze14. This is a serious issue as the data in the DB-Dump is corrupt (no DB-Backup possible).<br />Like Benjamin Albrecht suggested, using Doctrine SessionInitialization with 'SET NAMES utf8' seems to fix this issue.</p></div>
  </div>
  

  <div id="change-151563" class="journal has-notes">
    <h4><a href="45407.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/37906">Benjamin Albrecht</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-02-17" title="2013-02-17 15:05">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-151563-notes"><p>Hi,</p>


	<p>we are using an AOP aspect to set the doctrine SQLSesstionInit as a workaround:<br />With this solution it's not necessary to patch the core and the data in your DB is valid ;-)</p>


<pre>
&lt;?php
namespace Your\Package\Aspect;

use TYPO3\Flow\Annotations as Flow;

/**
 * @Flow\Aspect
 */
class EntityManagerFactoryAspect {
    /**
     * @Flow\Around("method(TYPO3\Flow\Persistence\Doctrine\EntityManagerFactory-&gt;create())")
     * @param \TYPO3\Flow\Aop\JoinPointInterface $joinPoint The current join point
     * @return \Doctrine\ORM\EntityManager
     */
    public function sqlSessionInitAdvice(\TYPO3\Flow\Aop\JoinPointInterface $joinPoint) {
        // @var $entityManager \Doctrine\ORM\EntityManager
        $entityManager = $joinPoint-&gt;getAdviceChain()-&gt;proceed($joinPoint);
        // @var $eventManager \Doctrine\Common\EventManager
        $eventManager = $entityManager-&gt;getEventManager();

        $sql = "SET NAMES utf8;";

        $sqlSessionInit = new \Doctrine\DBAL\Event\Listeners\SQLSessionInit($sql);

        $eventManager-&gt;addEventSubscriber($sqlSessionInit);

        return $entityManager;
    }
}
?&gt;
</pre>

	<p>This github gist gave us the inspiration to our solution: <a class="external" href="../../external.html?link=https://gist.github.com/bwaidelich/3917639">https://gist.github.com/bwaidelich/3917639</a><br />(thx to @khuppenbauer on twitter for this hint)</p></div>
  </div>
  

  <div id="change-176803" class="journal has-notes">
    <h4><a href="45407.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4014">Daniel Ostmann</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-08-07" title="2013-08-07 14:20">almost 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-176803-notes"><p>You can use this configuration in your settings file:</p>


<pre>
TYPO3:
  Flow:
    persistence:
      backendOptions:
        driverOptions:
          1002: 'SET NAMES utf8'
</pre>

	<p>Since we can't use constants in the configuration file we use it's value of 1002 (PDO::MYSQL_ATTR_INIT_COMMAND).</p>


	<p>See also: <a class="external" href="../../external.html?link=http://www.php.net/manual/de/pdo.construct.php#96325">http://www.php.net/manual/de/pdo.construct.php#96325</a></p></div>
  </div>
  

  <div id="change-177661" class="journal has-notes has-details">
    <h4><a href="45407.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/10">Karsten Dambekalns</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-08-14" title="2013-08-14 16:23">almost 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Closed</i></li>
      
       <li><strong>Assigned To</strong> set to <i>Karsten Dambekalns</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-177661-notes"><p>This is an issue we had fixed in our own version of Doctrine 2 DBAL, see <a class="external" href="../../external.html?link=https://review.typo3.org/#/c/7746/">https://review.typo3.org/#/c/7746/</a></p>


	<p>But since we use the unmodified version now, this is an issue that needs to be fixed with Doctrine, as notes in <a class="external" href="../../external.html?link=http://www.doctrine-project.org/jira/browse/DBAL-351">http://www.doctrine-project.org/jira/browse/DBAL-351</a> which points to <a class="external" href="../../external.html?link=https://github.com/doctrine/dbal/pull/206">https://github.com/doctrine/dbal/pull/206</a>. This one was dismissed though, pointing out a solution.</p>


	<p>The use of <code>driverOptions</code> is probably the easiest way (short of upgrading PHP).</p></div>
  </div>
  

  <div id="change-184195" class="journal has-notes">
    <h4><a href="45407.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/637">Kay Strobach</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-09-26" title="2013-09-26 10:49">almost 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-184195-notes"><p>This Option should be the default for MySQL ... overriding is ok, but this is definitly a problem on many hosts!<br />Atleast it should be in the example yaml file ...</p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-45407-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/45407.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="45407.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/45407 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:06:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
