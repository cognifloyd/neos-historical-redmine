<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/12862 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 21:57:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Story #12862: As Roger, I want a clean Property Mapper - TYPO3 Flow Base Distribution - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/12862.atom" rel="alternate" title="TYPO3 Flow Base Distribution - Story #12862: As Roger, I want a clean Property Mapper" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 current sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/search" accesskey="4" style="">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>TYPO3 Flow Base Distribution</h1>
        <div id="quicklinks"></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/rb/master_backlog/flow3-distribution-base" class="rb-master-backlogs">Backlogs</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues/calendar" class="calendar">Calendar</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="level-1 current sorting-0">TYPO3 Flow Base Distribution</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-eel" class="level-2 sorting-0">TYPO3.Eel</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="level-2 sorting-0">TYPO3.Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-fluid" class="level-2 sorting-0">TYPO3.Fluid</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-kickstart" class="level-2 sorting-0">TYPO3.Kickstart</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-welcome" class="level-2 sorting-0">TYPO3.Welcome</a><a href="../../external.html?link=https://forge.typo3.org/projects/packages" class="level-1 sorting-10">Packages</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-apps" class="level-1 sorting-30">Applications</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues/report">Summary</a><br />




  <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues/calendar">Calendar</a><br />



            <div id="backlogs_view_issues_sidebar"></div>
            <script type="text/javascript">
              jQuery(document).ready(function() {
                jQuery('#backlogs_view_issues_sidebar').load('../../external.html?link=https://forge.typo3.org/rb/hooks/sidebar/sprint/786?project_id=flow3-distribution-base');
              });
            </script>
          

<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=369" class="query">Issues under review</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=262" class="query">Open Issues for 1.0.6</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=192" class="query">Open issues for 1.1.1</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=463" class="query">Open issues for 2.0</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=427" class="query">Open issues for 2.0.x</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=204" class="query">Recently modified</a>



  
    <div id="watchers">
      

<h3>Watchers (1)</h3>

<ul><li><a href="../../external.html?link=https://forge.typo3.org/users/391">Peter Niederlag</a></li></ul>

    </div>
  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-12862-watcher"></span>


</div>


<h2>Story #12862</h2>

<div class="issue status-7 priority-2 closed parent details">
  

  

<div class="subject">
<div><h3>As Roger, I want a clean Property Mapper</h3></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-08" title="2011-02-08 09:11">over 4 years</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 09:29">about 4 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Resolved</td>
    <th class="start-date">Start date:</th><td class="start-date"></td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Should have</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="closed" style="width: 67%;"></td><td class="todo" style="width: 33%;"></td></tr></table><p class="pourcent">67%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">-</td>
    
    <th></th>
    <td></td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version"><a href="../../external.html?link=https://forge.typo3.org/versions/786">1.0 beta 1</a></td>
    
</tr>

<tr><th>Story points</th><td>-</td></tr><tr><th>Velocity based estimate</th><td>-</td></tr>
</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <ul class="toc right"><li><a href="#Goal">Goal</a></li><li><a href="#Wanted-Features">Wanted Features</a></li><li><a href="#Basic-Interface">Basic Interface</a></li><li><a href="#PropertyMappingConfiguration">PropertyMappingConfiguration</a></li><li><a href="#Default-Property-Mapping-Configuration">Default Property Mapping Configuration</a></li><li><a href="#Type-Converter-examples">Type Converter examples</a><ul><li><a href="#Entity-Type-Converter">Entity Type Converter</a></li><li><a href="#Date-Type-Converter">Date Type Converter</a></li><li><a href="#SplObjectStorageArrayCollection-Type-Converter">SplObjectStorage/ArrayCollection Type Converter</a></li></ul>
</li><li><a href="#Error-Handling">Error Handling</a></li><li><a href="#Validation-Partial-Validation">Validation / Partial Validation</a></li><li><a href="#Naming">Naming</a></li><li><a href="#Further-work">Further work</a></li></ul>


	<a name="Goal"></a>
<h2 >Goal<a href="#Goal" class="wiki-anchor">&para;</a></h2>


	<p><strong>The property mapper maps simple types to Objects</strong>. (Hence, we (for now) drop the Object to Object support, although this could be added later)</p>


	<p><strong>The Property Mapper maps all values present in $source to $target (or a subset thereof)</strong> (right now, it requires a list of properties to be mapped, and if $source[$propertyName] does not exist, an error is thrown)</p>


	<ul>
	<li>We try to strip down the Property Mapper, and make it extensible instead.</li>
	</ul>


	<a name="Wanted-Features"></a>
<h2 >Wanted Features<a href="#Wanted-Features" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>Support for Object Converters:
	<ul>
	<li>array / ArrayObject / SplObjectStorage</li>
		<li>DateTime use case</li>
		<li>File Upload (Resource objects)</li>
	</ul>
	</li>
		<li>Partial Validation should be supported</li>
		<li>Property Merging should be supported (pass in existing object as base-object)</li>
		<li>Better error handling in case target property is not found (right now, NULL returned)</li>
		<li>Mapping should be configurable</li>
		<li>Secure by default</li>
	</ul>


	<a name="Basic-Interface"></a>
<h2 >Basic Interface<a href="#Basic-Interface" class="wiki-anchor">&para;</a></h2>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>map(mixed <span class="local-variable">$source</span>, <span class="predefined-type">string</span> <span class="local-variable">$targetType</span>, <span class="constant">PropertyMappingConfigurationInterface</span> <span class="local-variable">$propertyMappingConfiguration</span> = <span class="predefined-constant">NULL</span>)
</span></code></pre>

	<ul>
	<li><code>$source</code> can be:
	<ul>
	<li>all simple values (integer, string, ...)</li>
		<li>ARRAY</li>
		<li>an Object implementing <code>ArrayAccess</code></li>
		<li><strong>We will drop support for arbitary objects through <code>ObjectAccess::isPropertyGettable</code></strong> (for now)</li>
		<li>else EXCEPTION</li>
	</ul></li>
	</ul>


	<ul>
	<li><code>$target</code> is the classname on which the value should be mapped to (or a simple type)</li>
	</ul>


	<p>Pseudocode:<br /><pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span>map(...) {
<span class="line-numbers"> 2</span>    <span class="keyword">if</span> (<span class="local-variable">$propertyMappingConfiguration</span> === <span class="predefined-constant">NULL</span>) {
<span class="line-numbers"> 3</span>        <span class="local-variable">$propertyMappingConfiguration</span> = <span class="local-variable">$this</span>-&gt;buildDefaultPropertyMappingConfiguration();
<span class="line-numbers"> 4</span>    }
<span class="line-numbers"> 5</span>    <span class="local-variable">$propertyMappingConfiguration</span>-&gt;setTargetType(<span class="local-variable">$targetType</span>); <span class="comment">// Just a convenience shorthand method</span>
<span class="line-numbers"> 6</span>    <span class="local-variable">$this</span>-&gt;doMapping(....);
<span class="line-numbers"> 7</span>}
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span><span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">doMapping</span>(mixed <span class="local-variable">$source</span>, <span class="local-variable">$propertyMappingConfiguration</span>) {
<span class="line-numbers"><strong>10</strong></span>    <span class="local-variable">$typeConverter</span> = <span class="local-variable">$this</span>-&gt;somehowDetermineTypeConverter(); <span class="comment">// TODO, see below</span>
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>    <span class="local-variable">$object</span> = <span class="local-variable">$typeConverter</span>-&gt;convertFrom(<span class="local-variable">$source</span>, <span class="local-variable">$propertyMappingConfiguration</span>);
<span class="line-numbers">13</span>
<span class="line-numbers">14</span>    <span class="keyword">foreach</span> (<span class="local-variable">$typeConverter</span>-&gt;getPropertyNames(<span class="local-variable">$source</span>) <span class="keyword">as</span> <span class="local-variable">$sourcePropertyName</span>) {
<span class="line-numbers">15</span>        <span class="local-variable">$targetPropertyName</span> = <span class="local-variable">$propertyMappingConfiguration</span>-&gt;getTargetPropertyName(<span class="local-variable">$sourcePropertyName</span>);
<span class="line-numbers">16</span>        <span class="keyword">if</span> (!<span class="local-variable">$propertyMappingConfiguration</span>-&gt;shouldMap(<span class="local-variable">$targetPropertyName</span>)) <span class="keyword">continue</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span>        <span class="local-variable">$mappedPropertyValue</span> = <span class="local-variable">$this</span>-&gt;doMapping(<span class="local-variable">$source</span>[<span class="local-variable">$sourcePropertyName</span>], <span class="local-variable">$propertyMappingConfiguration</span>-&gt;getConfigurationFor(<span class="local-variable">$targetPropertyName</span>));
<span class="line-numbers">19</span>
<span class="line-numbers"><strong>20</strong></span>        <span class="local-variable">$typeConverter</span>-&gt;setResultInTarget(<span class="local-variable">$target</span>, <span class="local-variable">$targetPropertyName</span>, <span class="local-variable">$mappedPropertyValue</span>);
<span class="line-numbers">21</span>    }
<span class="line-numbers">22</span>    <span class="keyword">return</span> <span class="local-variable">$object</span>;
<span class="line-numbers">23</span>}
</span></code></pre></p>


	<ul>
	<li>The property mapper only <strong>delegates</strong> the actual mapping to <strong>Type Converters</strong>.</li>
		<li>Type converters expose the following information:
	<ul>
	<li>Applicable source types</li>
		<li>The target type the converter can convert to</li>
		<li>A priority</li>
	</ul>
	</li>
		<li>The used type converter is determined as follows:
	<ul>
	<li>If a TypeConverter is set inside the current <code>propertyMappingConfiguration</code>, this one is taken.</li>
		<li>Else, we do the following:<br /><pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="local-variable">$typeConvertersWhichCanHandleSourceType</span> = <span class="comment">// first, we pick all TypeConverters</span>
<span class="line-numbers"> 2</span>        <span class="comment">// which can handle $sourceType, and put it into an</span>
<span class="line-numbers"> 3</span>        <span class="comment">// associative array where KEY is the target class name of the converter</span>
<span class="line-numbers"> 4</span><span class="local-variable">$classNamesInInheritanceHierarchy</span> = <span class="comment">// $targetType combined with all superclasses</span>
<span class="line-numbers"> 5</span>        <span class="comment">// and interfaces, ordered from the inside out (so the $targetType</span>
<span class="line-numbers"> 6</span>        <span class="comment">// is the first element in the list)</span>
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span><span class="keyword">foreach</span> (<span class="local-variable">$classNamesInInheritanceHierarchy</span> <span class="keyword">as</span> <span class="local-variable">$singleTargetClassName</span>) {
<span class="line-numbers"> 9</span>    <span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$typeConvertersWhichCanHandleSourceType</span>[<span class="local-variable">$singleTargetClassName</span>])) {
<span class="line-numbers"><strong>10</strong></span>        <span class="keyword">return</span> the type converter from <span class="local-variable">$typeConvertersWhichCanHandleSourceType</span>[<span class="local-variable">$singleTargetClassName</span>] with highest priority
<span class="line-numbers">11</span>    }
<span class="line-numbers">12</span>}
<span class="line-numbers">13</span><span class="comment">// Exception if no type converter found</span>
</span></code></pre></li>
	</ul></li>
	</ul>


	<ul>
	<li>Type Converters have to adhere to the following interface:<br /><pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">convertFrom</span>(<span class="local-variable">$source</span>, <span class="local-variable">$propertyMappingConfiguration</span>);
<span class="line-numbers">2</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getPropertyNames</span>(<span class="local-variable">$source</span>);
<span class="line-numbers">3</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setMappingResultInTarget</span>(<span class="local-variable">$target</span>, <span class="local-variable">$propertyName</span>, <span class="local-variable">$mappingResult</span>);
</span></code></pre></li>
	</ul>


	<ul>
	<li>In case a type converter does <strong>not</strong> want to handle a certain element (for whatever reason), he can throw an <code>DontWantToHandleThisInputException</code> inside <code>convertFrom</code>. Then, the next Type converter according to the above rules is taken.</li>
	</ul>


	<ul>
	<li>Furthermore, the Property Mapper <strong>can handle renaming of properties</strong>, see the method <code>getTargetPropertyName</code> in the <code>PropertyMappingConfigurationInterface</code></li>
	</ul>


	<a name="PropertyMappingConfiguration"></a>
<h2 >PropertyMappingConfiguration<a href="#PropertyMappingConfiguration" class="wiki-anchor">&para;</a></h2>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">interface</span> <span class="constant">PropertyMappingConfigurationInterface</span> {
<span class="line-numbers"> 2</span>
<span class="line-numbers"> 3</span>    <span class="comment">/**</span>
<span class="line-numbers"> 4</span><span class="comment">     * @return string</span>
<span class="line-numbers"> 5</span><span class="comment">     */</span>
<span class="line-numbers"> 6</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getTargetType</span>();
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>    <span class="comment">/**</span>
<span class="line-numbers"> 9</span><span class="comment">     * @return TRUE if the given propertyName should be mapped</span>
<span class="line-numbers"><strong>10</strong></span><span class="comment">     */</span>
<span class="line-numbers">11</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">shouldMap</span>(<span class="local-variable">$propertyName</span>);
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>    <span class="comment">/**</span>
<span class="line-numbers">14</span><span class="comment">     * @return PropertyMappingConfigurationInterface the property mapping configuration for the given PropertyName.</span>
<span class="line-numbers">15</span><span class="comment">     */</span>
<span class="line-numbers">16</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getConfigurationFor</span>(<span class="local-variable">$propertyName</span>);
<span class="line-numbers">17</span>
<span class="line-numbers">18</span>    <span class="comment">/**</span>
<span class="line-numbers">19</span><span class="comment">     * @return string property name of target; can be used to rename properties from source to target.</span>
<span class="line-numbers"><strong>20</strong></span><span class="comment">     */</span>
<span class="line-numbers">21</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getTargetPropertyName</span>(<span class="local-variable">$sourcePropertyName</span>);
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>    <span class="comment">/**</span>
<span class="line-numbers">24</span><span class="comment">     * @return mixed configuration value for the specific $typeConverterClassName. Can be used by Type Converters to fetch converter-specific configuration</span>
<span class="line-numbers">25</span><span class="comment">     */</span>
<span class="line-numbers">26</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getConfigurationValue</span>(<span class="local-variable">$typeConverterClassName</span>, <span class="local-variable">$key</span>);
<span class="line-numbers">27</span>}
</span></code></pre>

	<p>This interface will have an implementing class "PropertyMappingConfiguration", looking like the following:</p>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">class</span> <span class="class">PropertyMappingConfiguration</span> <span class="keyword">implements</span> <span class="constant">PropertyMappingConfigurationInterface</span> {
<span class="line-numbers"> 2</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setTargetType</span>(<span class="local-variable">$type</span>);
<span class="line-numbers"> 3</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setMapping</span>(<span class="local-variable">$sourcePropertyName</span>, <span class="local-variable">$targetPropertyName</span>);
<span class="line-numbers"> 4</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setConfigurationValue</span>(<span class="local-variable">$typeConverter</span>, <span class="local-variable">$key</span>, <span class="local-variable">$value</span>);
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>    <span class="comment">/**</span>
<span class="line-numbers"> 7</span><span class="comment">     * Returns the default configuration for all sub-objects, ready to be modified</span>
<span class="line-numbers"> 8</span><span class="comment">     */</span>
<span class="line-numbers"> 9</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">defaultSubConfiguration</span>();
<span class="line-numbers"><strong>10</strong></span>
<span class="line-numbers">11</span>    <span class="comment">/**</span>
<span class="line-numbers">12</span><span class="comment">     * Returns the configuration for the specific property path, ready to be modified</span>
<span class="line-numbers">13</span><span class="comment">     */</span>
<span class="line-numbers">14</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">at</span>(<span class="local-variable">$propertyPath</span>);
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>}
</span></code></pre>

	<p>This API can then be used as follows:</p>


	<ul>
	<li>To globally disable the modification of entities by the property mapper:<br /> <pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="local-variable">$propertyMappingConfiguration</span>-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">modificationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">FALSE</span>);</span></code></pre></li>
		<li>To disable the modification of sub-entities of the root element:<br /> <pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="local-variable">$propertyMappingConfiguration</span>-&gt;defaultSubConfiguration()-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">modificationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">FALSE</span>);</span></code></pre></li>
		<li>To enable the creation of sub-objects inside a certain element:<br /> <pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="local-variable">$propertyMappingConfiguration</span>-&gt;at(<span class="string"><span class="delimiter">'</span><span class="content">subobject1.subsubobject2</span><span class="delimiter">'</span></span>)-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">creationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">TRUE</span>);</span></code></pre></li>
	</ul>


	<p>Furthermore, there will be a subclass <code>ControllerPropertyMappingConfiguration</code>, which has some convenience methods implemented such that people can program against a type-safe API:</p>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="keyword">class</span> <span class="class">ControllerPropertyMappingConfiguration</span> <span class="keyword">extends</span> <span class="constant">PropertyMappingConfiguration</span> {
<span class="line-numbers">2</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">allowCreationOfSubObjectsAt</span>(<span class="local-variable">$position</span>) {
<span class="line-numbers">3</span>        <span class="local-variable">$this</span>-&gt;at(<span class="local-variable">$position</span>)-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">creationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">TRUE</span>);
<span class="line-numbers">4</span>    }
<span class="line-numbers">5</span>    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">allowModificationOfSubObjectsAt</span>(<span class="local-variable">$position</span>) {
<span class="line-numbers">6</span>        <span class="local-variable">$this</span>-&gt;at(<span class="local-variable">$position</span>)-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">modificationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">TRUE</span>);
<span class="line-numbers">7</span>    }
<span class="line-numbers">8</span>}
</span></code></pre>

	<a name="Default-Property-Mapping-Configuration"></a>
<h2 >Default Property Mapping Configuration<a href="#Default-Property-Mapping-Configuration" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>The default property mapping configuration for the <strong>top level</strong> should configure the <code>Entity Type Converter</code> to <strong>modify</strong> and <strong>create new</strong> objects</li>
		<li>The property mapping configuration further down the hierarchy should configure the <code>Entity Type Converter</code> to <strong>not modify</strong> and <strong>not create</strong> objects.</li>
		<li>The above two things are safety precautions for the user.</li>
		<li>This boils down to the following code:</li>
	</ul>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span> <span class="local-variable">$propertyMappingConfiguration</span>-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">modificationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">TRUE</span>);
<span class="line-numbers">2</span> <span class="local-variable">$propertyMappingConfiguration</span>-&gt;defaultSubConfiguration()-&gt;setConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3....</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">modificationAllowed</span><span class="delimiter">'</span></span>, <span class="predefined-constant">FALSE</span>);
</span></code></pre>

	<a name="Type-Converter-examples"></a>
<h2 >Type Converter examples<a href="#Type-Converter-examples" class="wiki-anchor">&para;</a></h2>


	<p>Here follow some examples of type converters, to see the concept more easily:</p>


	<a name="Entity-Type-Converter"></a>
<h3 >Entity Type Converter<a href="#Entity-Type-Converter" class="wiki-anchor">&para;</a></h3>


	<ul>
	<li><strong>Input Type</strong>: String and Array</li>
		<li><strong>Output Type</strong>: Object</li>
		<li><strong>Priority</strong>: low</li>
	</ul>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">convertFrom</span>(<span class="local-variable">$source</span>, <span class="local-variable">$propertyMappingConfiguration</span>) {
<span class="line-numbers"> 2</span>    <span class="keyword">if</span> (<span class="predefined">is_string</span>(<span class="local-variable">$source</span>)) {
<span class="line-numbers"> 3</span>        <span class="keyword">if</span> (<span class="comment">/* is UUID */</span>) {
<span class="line-numbers"> 4</span>            <span class="comment">// create and return object</span>
<span class="line-numbers"> 5</span>        } <span class="keyword">else</span> {
<span class="line-numbers"> 6</span>            <span class="comment">// Exception</span>
<span class="line-numbers"> 7</span>        }
<span class="line-numbers"> 8</span>    }
<span class="line-numbers"> 9</span>
<span class="line-numbers"><strong>10</strong></span>    <span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$source</span>[<span class="string"><span class="delimiter">'</span><span class="content">__identity</span><span class="delimiter">'</span></span>])) {
<span class="line-numbers">11</span>        <span class="local-variable">$target</span> = <span class="comment">// fetch from persistence</span>
<span class="line-numbers">12</span>        <span class="keyword">if</span> (<span class="predefined">count</span>(<span class="local-variable">$source</span>) &gt; <span class="integer">1</span>) {
<span class="line-numbers">13</span>            <span class="keyword">if</span> (<span class="local-variable">$propertyMappingConfiguration</span>-&gt;getConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3</span><span class="content">\.</span><span class="content">...</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">modificationAllowed</span><span class="delimiter">'</span></span>) !== <span class="predefined-constant">TRUE</span>) {
<span class="line-numbers">14</span>                <span class="comment">// throw exception</span>
<span class="line-numbers">15</span>            }
<span class="line-numbers">16</span>            <span class="local-variable">$target</span> = <span class="keyword">clone</span> <span class="local-variable">$target</span>;
<span class="line-numbers">17</span>        }
<span class="line-numbers">18</span>    } <span class="keyword">else</span> {
<span class="line-numbers">19</span>        <span class="keyword">if</span> (<span class="local-variable">$propertyMappingConfiguration</span>-&gt;getConfigurationValue(<span class="string"><span class="delimiter">'</span><span class="content">F3</span><span class="content">\.</span><span class="content">...</span><span class="content">\E</span><span class="content">ntityConverter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">creationAllowed</span><span class="delimiter">'</span></span>) !== <span class="predefined-constant">TRUE</span>) {
<span class="line-numbers"><strong>20</strong></span>            <span class="comment">// throw exception</span>
<span class="line-numbers">21</span>        }
<span class="line-numbers">22</span>        <span class="local-variable">$target</span> = <span class="comment">// new</span>
<span class="line-numbers">23</span>    }
<span class="line-numbers">24</span>
<span class="line-numbers">25</span>    <span class="keyword">return</span> <span class="local-variable">$target</span>;
<span class="line-numbers">26</span>}
<span class="line-numbers">27</span>
<span class="line-numbers">28</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getPropertyNames</span>(<span class="local-variable">$source</span>) {
<span class="line-numbers">29</span>        <span class="keyword">if</span> (<span class="predefined">is_string</span>(<span class="local-variable">$source</span>)) <span class="keyword">return</span> <span class="predefined">array</span>();
<span class="line-numbers"><strong>30</strong></span>        <span class="keyword">return</span> all <span class="local-variable">$source</span> property names, *except* __identity;
<span class="line-numbers">31</span>}
<span class="line-numbers">32</span>
<span class="line-numbers">33</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setMappingResultInTarget</span>(<span class="local-variable">$target</span>, <span class="local-variable">$propertyName</span>, <span class="local-variable">$mappingResult</span>) {
<span class="line-numbers">34</span>        <span class="comment">// Set Property through Object Access</span>
<span class="line-numbers">35</span>}
</span></code></pre>

	<a name="Date-Type-Converter"></a>
<h3 >Date Type Converter<a href="#Date-Type-Converter" class="wiki-anchor">&para;</a></h3>


	<ul>
	<li><strong>Input Type</strong>: String and Array</li>
		<li><strong>Output Type</strong>: DateTime</li>
		<li><strong>Priority</strong>: low</li>
	</ul>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">convertFrom</span>(<span class="local-variable">$source</span>, <span class="local-variable">$propertyMappingConfiguration</span>) {
<span class="line-numbers"> 2</span>    <span class="keyword">new</span> <span class="constant">DateTime</span>(<span class="local-variable">$source</span>); <span class="comment">// or more advanced...</span>
<span class="line-numbers"> 3</span>};
<span class="line-numbers"> 4</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getPropertyNames</span>() {
<span class="line-numbers"> 5</span>    <span class="keyword">return</span> <span class="predefined">array</span>();
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setMappingResultInTarget</span>(<span class="local-variable">$target</span>, <span class="local-variable">$propertyName</span>, <span class="local-variable">$mappingResult</span>) {
<span class="line-numbers"> 8</span>    <span class="comment">// empty, as it is never called</span>
<span class="line-numbers"> 9</span>}
</span></code></pre>

	<a name="SplObjectStorageArrayCollection-Type-Converter"></a>
<h3 >SplObjectStorage/ArrayCollection Type Converter<a href="#SplObjectStorageArrayCollection-Type-Converter" class="wiki-anchor">&para;</a></h3>


	<ul>
	<li><strong>Input Type</strong>: Array</li>
		<li><strong>Output Type</strong>: SplObjectStorage</li>
		<li><strong>Priority</strong>: low</li>
	</ul>


<pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">convertFrom</span>(<span class="local-variable">$source</span>, <span class="local-variable">$propertyMappingConfiguration</span>) {
<span class="line-numbers"> 2</span>    <span class="keyword">return</span> <span class="keyword">new</span> \<span class="constant">SplObjectStorage</span>();
<span class="line-numbers"> 3</span>};
<span class="line-numbers"> 4</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getPropertyNames</span>(<span class="local-variable">$source</span>) {
<span class="line-numbers"> 5</span>    <span class="keyword">return</span> <span class="predefined">array_keys</span>(<span class="local-variable">$source</span>);
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setMappingResultInTarget</span>(<span class="local-variable">$target</span>, <span class="local-variable">$propertyName</span>, <span class="local-variable">$mappingResult</span>) {
<span class="line-numbers"> 9</span>    <span class="local-variable">$target</span>-&gt;attach(<span class="local-variable">$value</span>);
<span class="line-numbers"><strong>10</strong></span>}
</span></code></pre>

	<a name="Error-Handling"></a>
<h2 >Error Handling<a href="#Error-Handling" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>Instead of outputting human-readable error messages, the property mapper will throw <strong>exceptions</strong> in case of errors. For things like mandatory properties, specific validators should be used.</li>
	</ul>


	<a name="Validation-Partial-Validation"></a>
<h2 >Validation / Partial Validation<a href="#Validation-Partial-Validation" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>The property mapper will <strong>not</strong> execute any validators for the given objects.</li>
		<li>However, it should return a list of mapped properties. This list can be used later, such that the ObjectValidator only needs to validate changed properties.</li>
	</ul>


	<a name="Naming"></a>
<h2 >Naming<a href="#Naming" class="wiki-anchor">&para;</a></h2>


	<p><strong>Object Converters will be superseded by this concept, and thrown away.</strong></p>


	<p><strong>We suggest to change the naming in the following way:</strong></p>


	<ul>
	<li>PropertyMapper -> TypeMapper / ObjectMapper?</li>
		<li>Object Converter -> Type Converter</li>
	</ul>


	<a name="Further-work"></a>
<h2 >Further work<a href="#Further-work" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>This concept could be extended lateron to work with <strong>arbitrary</strong> input objects, not just simple types. However, one would then need a way to deal with object inheritance hierarchies on the source side as well.</li>
		<li>Extend the concept such that Half-ready objects as $target are also supported; but we would use an explicit new API function for this:<br /><pre><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>merge(mixed <span class="local-variable">$source</span>, <span class="predefined-type">object</span> <span class="local-variable">$targetObject</span>, <span class="constant">PropertyMappingConfigurationInterface</span> <span class="local-variable">$propertyMappingConfiguration</span> = <span class="predefined-constant">NULL</span>)
</span></code></pre></li>
	</ul>
  </div>






<hr />
<div id="issue_tree">
<div class="contextual">
  
</div>
<p><strong>Subtasks</strong></p>
<form><table class="list issues"><tr class="issue issue-13943 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="13943" /></td><td class="subject"><a href="13943.html" class="issue status-7 priority-2 closed child">Task #13943</a>: Restructured MVC Error Handling </td><td>Resolved</td><td><a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr><tr class="issue issue-13942 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="13942" /></td><td class="subject"><a href="13942.html" class="issue status-7 priority-2 closed child">Task #13942</a>: Restructured Property Mapper</td><td>Resolved</td><td><a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr><tr class="issue issue-13161 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="13161" /></td><td class="subject"><a href="13161.html" class="issue status-7 priority-2 closed child">Task #13161</a>: We also need some better Error / Warning / Notice handling</td><td>Resolved</td><td></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr></table></form>
</div>




</div>




<div id="history">
<h3>History</h3>

  <div id="change-32158" class="journal has-details">
    <h4><a href="12862.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-08" title="2011-02-08 09:11">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Position</strong> deleted (<strike><i>1</i></strike>)</li>
      
       <li><strong>Position</strong> set to <i>15</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-32173" class="journal has-details">
    <h4><a href="12862.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-08" title="2011-02-08 10:07">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Assigned To</strong> set to <i>Sebastian Kurfuerst</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-32260" class="journal has-notes">
    <h4><a href="12862.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/391">Peter Niederlag</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-08" title="2011-02-08 21:12">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-32260-notes"><a name="Date-Type-Converter"></a>
<h2 >Date Type Converter<a href="#Date-Type-Converter" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>As Mr. Glue I want it to call the constructor of my Extension class if I have a property that has a type that extends DateTime()</li>
	</ul>


	<a name="Float-Type-Converter"></a>
<h2 >Float Type Converter<a href="#Float-Type-Converter" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>As Mr. Glue I want to influence what format the input must have</li>
	</ul></div>
  </div>
  

  <div id="change-32339" class="journal has-notes">
    <h4><a href="12862.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-10" title="2011-02-10 12:45">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-32339-notes"><p>Hey Peter,</p>


	<p>thanks for your input; both cases would be possible with the new concept:</p>


<blockquote>

	<a name="Date-Type-Converter"></a>
<h2 >Date Type Converter<a href="#Date-Type-Converter" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>As Mr. Glue I want it to call the constructor of my Extension class if I have a property that has a type that extends DateTime()</li>
	</ul>


</blockquote>

	<p>This would be done differently with the new concept: You'd create your custom TypeConverter, which can convert to your extended DateTime object. This converter is then automatically used.</p>


<blockquote>

	<a name="Float-Type-Converter"></a>
<h2 >Float Type Converter<a href="#Float-Type-Converter" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>As Mr. Glue I want to influence what format the input must have</li>
	</ul>


</blockquote>

	<p>A Float Type Converter could be configurable through the PropertyMappingConfiguration, so this should also be possible.</p></div>
  </div>
  

  <div id="change-32352" class="journal has-notes">
    <h4><a href="12862.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-10" title="2011-02-10 14:36">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-32352-notes"><p>I just updated the concept after discussions with Andi and Christian.</p></div>
  </div>
  

  <div id="change-32567" class="journal has-notes">
    <h4><a href="12862.html#note-6" class="journal-link">#6</a>
    
    <a name="note-6"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/10">Karsten Dambekalns</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-14" title="2011-02-14 11:04">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-32567-notes">Some comments:
	<ul>
	<li>seeing object-to-object go makes me uneasy, even if it's only "for now".</li>
		<li><code>map()</code> without a target object is actually <code>convert()</code>
	<ul>
	<li>make <code>map()</code> accept a target object, allow NULL to indicate "convert" mode as a special case</li>
		<li>or call it <code>convert()</code> and add <code>merge()</code> as suggested</li>
	</ul>
	</li>
		<li>the pseudo code to determine the matching type converter ignores the priority</li>
		<li>there seems to be no way to configure the mapping in a way like "allow mapping for all properties except ..." </li>
		<li>what does <code>PropertyMappingConfiguration::setMapping()</code> do?</li>
		<li><code>setMappingResultInTarget()</code> would use a domain model instance as a transfer object for infrastructure metadata...
	<ul>
	<li>no, it is actually badly named and would put the conversion result in the new object, aha...</li>
		<li>the SplObjectStorage-example is bad then, because it only ever attaches one object.</li>
	</ul></li>
	</ul>


	<p>On the naming of <code>PropertyMapper</code> - if anything, it now is an <code>ObjectCreator</code>, eyh? If <code>merge()</code> is added, it suddenly becomes a <code>TypeConverter</code> though, thus we have a name clash already. In the end, though, that's what it is: it converts stuff from <code>array</code> to <code>SomeObject</code> according to some configuration...</p></div>
  </div>
  

  <div id="change-33248" class="journal has-notes">
    <h4><a href="12862.html#note-7" class="journal-link">#7</a>
    
    <a name="note-7"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-02-22" title="2011-02-22 14:53">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-33248-notes"><p>- Improve error messages<br />- unschön: dass man für new/edit action auch eine initialize*Action braucht<br />- Idee mit Robert diskutiert:<br />    - Parameter bei "newAction" weglassen (können)<br />    - Momentaner Ablauf<br />        Validierungsfehler / Property Mapping Fehler<br />        errorAction<br />            - > packt argument errors in request<br />             - > forward zur letzten Action, ABER mit Argumenten der aktuellen  Action (HACK) -- dabei bleiben Errors erhalten (HACK!)<br />        letzte Action (die das Formular anzeigt) aus referrer<br />            - > Argumente werden <strong>nochmal</strong> gemappt, und "invalides" Domänen-Objekt gebaut<br />             - > ABER dontvalidate verhindert, dass Property Validatoren gebaut  werden (UNSCHÖN, greift nicht für Property Mapping errors)<br />            - > "invalides" domänenobjekt geht zum View -- > Basis für Formular<br />            - > Form ViewHelper geht in <strong>REQUEST</strong>- >getErrors(), um herauszufinden dass es Fehler gab (HACK)<br />    - Vorgeschlagener Ablauf<br />        Validierungsfehler / Property Mapping Fehler<br />        errorAction<br />             - > Fehler die es gab müssen <strong>irgendwo</strong> gespeichert werden (Error\Result) (im AbstractRequest); außerdem muss der "Original"-Request gespeichert werden<br />            - > forward zur letzten Action, <strong>mit Argumenten der letzten Action</strong> (die auch im Referrer gespeichert sein müssen)<br />        letzte Action (die das Formular anzeigt) aus referrer<br />            - > Genau gleicher Kontrollfluss wie im "nicht-fehler-Fall" <br />            - > View wird "normal" aufgerufen<br />             - > Form ViewHelper nutzt <code>Request->originalRequest->arguments</code>  zum Vor-Ausfüllen des Formulares (mit Fallback zum übergebenen Objekt)<br />            - > Form ViewHelper nutzt <code>Request->originalRequest->errors</code> um herauszufinden, welche Formularfelder fehlerhaft sind (und kann die dann umrahmen / Fehler darstellen, ...)</p>


	<p>/// VORALLEM WICHTIG FÜR EXTBASE:<br /><code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">mapRequestArgumentsToControllerArguments</span>() {
<span class="line-numbers"> 2</span>                <span class="keyword">foreach</span> (<span class="local-variable">$this</span>-&gt;arguments <span class="keyword">as</span> <span class="local-variable">$argument</span>) {
<span class="line-numbers"> 3</span>                        <span class="local-variable">$argumentName</span> = <span class="local-variable">$argument</span>-&gt;getName();
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>                        <span class="comment">// in EDITACTION request -- &quot;originale&quot; Request der Edit-Action (unmodifizierte Argumente)</span>
<span class="line-numbers"> 6</span>                        <span class="comment">// originalRequest -- Request der &quot;update&quot;-Action</span>
<span class="line-numbers"> 7</span>                         <span class="keyword">if</span> (compatible with extbase <span class="float">1.3</span> <span class="keyword">AND</span>  <span class="local-variable">$this</span>-&gt;request-&gt;originalRequest-&gt;hasArgument(<span class="local-variable">$argumentName</span>) {
<span class="line-numbers"> 8</span>                            <span class="local-variable">$argument</span>-&gt;setValue(<span class="local-variable">$this</span>-&gt;request-&gt;getArgument(<span class="local-variable">$argumentName</span>));
<span class="line-numbers"> 9</span>                        } <span class="keyword">elseif</span> (<span class="local-variable">$this</span>-&gt;request-&gt;hasArgument(<span class="local-variable">$argumentName</span>)) {
<span class="line-numbers"><strong>10</strong></span>                                <span class="local-variable">$argument</span>-&gt;setValue(<span class="local-variable">$this</span>-&gt;request-&gt;getArgument(<span class="local-variable">$argumentName</span>));
<span class="line-numbers">11</span>                        } <span class="keyword">elseif</span> (<span class="local-variable">$argument</span>-&gt;isRequired()) {
<span class="line-numbers">12</span>                                 <span class="keyword">throw</span> <span class="keyword">new</span>  \<span class="constant">F3</span>\<span class="constant">FLOW3</span>\<span class="constant">MVC</span>\<span class="predefined-constant">Exception</span>\<span class="constant">RequiredArgumentMissingException</span>(<span class="string"><span class="delimiter">'</span><span class="content">Required  argument &quot;</span><span class="delimiter">'</span></span> . <span class="local-variable">$argumentName</span>  . <span class="string"><span class="delimiter">'</span><span class="content">&quot; is not set.</span><span class="delimiter">'</span></span>, <span class="integer">1298012500</span>);
<span class="line-numbers">13</span>                        }
<span class="line-numbers">14</span>                }
<span class="line-numbers">15</span>        }
</span></code></p>


	<p>TODO:  dontvalidate würde NICHT mehr im ValidatorResolver aufgelöst werden,  sondern im ActionController::callActionMethod passieren (wo zwischen  ErrorAction und normaler Action unterschieden wird) - > TODO:  annotation umbenennen? @ignoreValidationErrors</p>


	<p>TODO Berlin: discuss Namespaces // Annotation Processing // Schema<br />@validation.ignoreErrors</p>


	<p>TODO: OriginalRequest in AbstractRequest hinzufügen</p>


	<p>TODO: Error\Result sollte für <strong>alle</strong> Arguments gelten<br />-- >  Arguments::haveErrors kann weggehauen werden; und  Arguments::getValidationErrors umbennenen in <code>Arguments::getMappingResult</code>  sollte Error\Result OBJEKT zurückgeben (und keinen Array) -- > <code>Arguments::haveErrors()</code> - > <code>Arguments::getMappingResult()->hasErrors()</code></p>


	<p>TODO: Abwärtskompatibilität -- wenn newAction erwartet Post, dann <br />   - > In Extbase Compatibilitätsflg einführen:<br />      - > tx_myext.extbaseCompatibilityVersion = 1.3<br />      - > PropertyMapper &#38; Validierung wie bisher</p>


	<p>"neuer" property mapper in Proprety\PropertyMapper<br />"alter" PM Property\DeprecatedPM</p>


	<p>Property\Mapper {<br />    map($1, $2, $3, ...) {<br />        if (Extbase 1.3) {<br />          - > <code>alter PM->map()</code><br />        } else {<br />            - > <code>neuer PM->map()</code><br />        }<br />}</p>


	<p>TODO: SubRequest</p>


<code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">new</span>(<span class="constant">Post</span> <span class="local-variable">$post</span> = <span class="predefined-constant">NULL</span>) {
<span class="line-numbers"> 2</span>    <span class="keyword">if</span> (<span class="local-variable">$post</span> != <span class="predefined-constant">NULL</span>) {
<span class="line-numbers"> 3</span>        <span class="local-variable">$post</span>-&gt;setBla(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>);
<span class="line-numbers"> 4</span>    }
<span class="line-numbers"> 5</span>    <span class="local-variable">$this</span>-&gt;view-&gt;assign(<span class="string"><span class="delimiter">'</span><span class="content">post</span><span class="delimiter">'</span></span>, <span class="local-variable">$post</span>);
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">create</span>(...<span class="constant">Post</span> <span class="local-variable">$post</span>) {
<span class="line-numbers"> 9</span>}
<span class="line-numbers"><strong>10</strong></span>
<span class="line-numbers">11</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">edit</span>(<span class="constant">Post</span>);
<span class="line-numbers">12</span>
<span class="line-numbers">13</span><span class="keyword">public</span> <span class="keyword">function</span> <span class="function">update</span>(<span class="constant">Post</span>) {
<span class="line-numbers">14</span>}
</span></code></div>
  </div>
  

  <div id="change-73408" class="journal has-details">
    <h4><a href="12862.html#note-8" class="journal-link">#8</a>
    
    <a name="note-8"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-05" title="2011-05-05 13:50">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Project</strong> changed from <i>Core Team</i> to <i>Base Distribution</i></li>
      
       <li><strong>Target version</strong> deleted (<strike><i>788</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73545" class="journal has-details">
    <h4><a href="12862.html#note-9" class="journal-link">#9</a>
    
    <a name="note-9"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:14">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Target version</strong> set to <i>1228</i></li>
      
       <li><strong>Position</strong> deleted (<strike><i>17837</i></strike>)</li>
      
       <li><strong>Position</strong> set to <i>4</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73551" class="journal has-details">
    <h4><a href="12862.html#note-10" class="journal-link">#10</a>
    
    <a name="note-10"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:17">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Project</strong> changed from <i>Base Distribution</i> to <i>TYPO3 Flow Base Distribution</i></li>
      
       <li><strong>Target version</strong> deleted (<strike><i>1228</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73555" class="journal has-details">
    <h4><a href="12862.html#note-11" class="journal-link">#11</a>
    
    <a name="note-11"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:17">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Target version</strong> set to <i>1.0 beta 1</i></li>
      
       <li><strong>Position</strong> deleted (<strike><i>4</i></strike>)</li>
      
       <li><strong>Position</strong> set to <i>3</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73595" class="journal has-notes has-details">
    <h4><a href="12862.html#note-12" class="journal-link">#12</a>
    
    <a name="note-12"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 09:29">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-73595-notes"><p>done.</p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-12862-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/12862.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="12862.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/12862 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 21:57:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
