<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/39740 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:01:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Feature #39740: Allow setting fixed values for route parts - TYPO3.Flow - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

#header #right-area, #header #right-area h1, #header #right-area a {
  color:transparent;
}

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/39740.atom" rel="alternate" title="TYPO3.Flow - Feature #39740: Allow setting fixed values for route parts" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 current sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="background-image:url(../headerimages/16.jpg);">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/search" accesskey="4" style="color:transparent">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>TYPO3.Flow</h1>
        <div id="quicklinks"></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="level-1 current sorting-0">TYPO3 Flow Base Distribution</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-eel" class="level-2 sorting-0">TYPO3.Eel</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="level-2 current sorting-0">TYPO3.Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-fluid" class="level-2 sorting-0">TYPO3.Fluid</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-kickstart" class="level-2 sorting-0">TYPO3.Kickstart</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-welcome" class="level-2 sorting-0">TYPO3.Welcome</a><a href="../../external.html?link=https://forge.typo3.org/projects/packages" class="level-1 sorting-10">Packages</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-apps" class="level-1 sorting-30">Applications</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues/report">Summary</a><br />







<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=375" class="query">Open documentation issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/issues?query_id=204" class="query">Recently modified</a>



  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-39740-watcher"></span>


</div>


<h2>Feature #39740</h2>

<div class="issue status-9 priority-2 closed details">
  

  

<div class="subject">
<div><h3>Allow setting fixed values for route parts</h3></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-08-12" title="2012-08-12 22:41">almost 3 years</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-06-12" title="2013-06-12 17:14">about 2 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Closed</td>
    <th class="start-date">Start date:</th><td class="start-date">2012-08-12</td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Should have</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent">0%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">MVC - Routing</td>
    
    <th></th>
    <td></td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version">-</td>
    
</tr>
<tr>
	<th>PHP Version:</th><td></td>
	<th>Complexity:</th><td></td>
</tr>
<tr>
	<th>Has patch:</th><td>No</td>
</tr>


</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>In some situations, it is desirable to have routes that are only applied to certain sets of parameters, e.g. to have some subpackage in a completely different URI namespace:</p>


<code>
api/v1/&lt;controller&gt;/&lt;action&gt; -&gt; package MyPackage, subpackage Api
&lt;controller&gt;/&lt;action&gt; -&gt; package MyPackage
</code>

	<p>You could of course use the <code>{@subpackage}</code> key in the route URI here:</p>


<code>
{@subpackage}/v1/{@controller}/{@action}
</code>

	<p>But as soon as you add a second subpackage, this will fail, because both subpackages would be matched by this route.</p>


	<p>Setting "api" as the default value of <span>@subpackage</span> would also fail here, as all requests with a controller and an action would be matched by this route then, leading to errors for controllers that do not exist in the Api subpackage.</p>


	<p>A solution for this is to allow fixed values for route parts, which are both</p>


	<ol>
	<li>matched when building the URI (so the route does not match if the <code>$routeValues</code> array passed to <code>resolves()</code> does not contain these fixed values)</li>
		<li>reconstructed when the URI is matched against the pattern (so they are available when resolving the controller and action)</li>
	</ol>


	<p>I propose to add these fixed values to the routeParts array in the configuration, either as a simple value for the route part name or as the value of the "value" subkey:</p>


<pre>
<code class="yaml syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span>-
<span class="line-numbers"> 2</span>  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">option A: fixed value as value of the route part name</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers"> 3</span>  <span class="key">uriPattern</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api/v1/{@controller}/{@action}</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers"> 4</span>  <span class="key">routeParts</span>:
<span class="line-numbers"> 5</span>    <span class="key"><span class="delimiter">'</span><span class="content">@package</span><span class="delimiter">'</span></span>:    <span class="string"><span class="content">'MyPackage'</span></span>
<span class="line-numbers"> 6</span>    <span class="key"><span class="delimiter">'</span><span class="content">@subpackage</span><span class="delimiter">'</span></span>: <span class="string"><span class="content">'Api'</span></span>
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>-
<span class="line-numbers"> 9</span>
<span class="line-numbers"><strong>10</strong></span>  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">option B: fixed value in the 'value' key</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">11</span>  <span class="key">uriPattern</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api/v1/{@controller}/{@action}</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">12</span>  <span class="key">routeParts</span>:
<span class="line-numbers">13</span>    <span class="key"><span class="delimiter">'</span><span class="content">@package</span><span class="delimiter">'</span></span>:    
<span class="line-numbers">14</span>      <span class="key">value</span>:     <span class="string"><span class="content">'MyPackage'</span></span>
<span class="line-numbers">15</span>    <span class="key"><span class="delimiter">'</span><span class="content">@subpackage</span><span class="delimiter">'</span></span>:
<span class="line-numbers">16</span>      <span class="key">value</span>:     <span class="string"><span class="content">'Api'</span></span>
</span></code><br /></pre>

	<p>I have implemented option A locally and will provide a patch after ironing out some glitches.</p>
  </div>








<hr />
<div id="relations">
<div class="contextual">

</div>

<p><strong>Related issues</strong></p>


<form>
<table class="list issues">

<tr class="issue hascontextmenu" id="relation-7611">
<td class="checkbox"><input name="ids[]" type="checkbox" value="43589" /></td>
<td class="subject">related to 
    TYPO3.Flow - 
    <a href="43589.html" class="issue status-7 priority-2 closed">Bug #43589</a>: Route defaults can be omitted when creating URIs
</td>
<td class="status">Resolved</td>
<td class="start_date">2012-12-04</td>
<td class="due_date"></td>
<td class="buttons"></td>
</tr>

</table>
</form>


<form action="../../external.html?link=https://forge.typo3.org/issues/39740/relations" id="new-relation-form" method="post" onsubmit="new Ajax.Request('/issues/39740/relations', {asynchronous:true, evalScripts:true, method:'post', onComplete:function(request){Form.Element.focus('relation_issue_to_id');}, parameters:Form.serialize(this)}); return false;" style="display: none;"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="IjgAk+sryuS7AAkPn7/ITUV652f6cwFBHN6GNTvW7o8=" /></div>


<p><select id="relation_relation_type" name="relation[relation_type]" onchange="setPredecessorFieldsVisibility();"><option value="relates">related to</option>
<option value="duplicates">duplicates</option>
<option value="duplicated">duplicated by</option>
<option value="blocks">blocks</option>
<option value="blocked">blocked by</option>
<option value="precedes">precedes</option>
<option value="follows">follows</option></select>
Issue #<input id="relation_issue_to_id" name="relation[issue_to_id]" size="10" type="text" />
<span id="predecessor_fields" style="display:none;">
Delay: <input id="relation_delay" name="relation[delay]" size="3" type="text" /> days
</span>
<input name="commit" type="submit" value="Add" />
<a href="#" onclick="Element.toggle('new-relation-form'); this.blur(); return false;">Cancel</a>
</p>

<div id="related_issue_candidates" class="autocomplete"></div>
<script type="text/javascript">
//<![CDATA[
observeRelatedIssueField('/issues/auto_complete?id=39740&amp;project_id=package-typo3-flow')
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>

</div>


</div>




<div id="history">
<h3>History</h3>

  <div id="change-127771" class="journal has-notes">
    <h4><a href="39740.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-08-12" title="2012-08-12 22:42">almost 3 years</a> ago</h4>

    
    <div class="wiki" id="journal-127771-notes"><p>Gnah, could somebody with the required permissions please fix the formatting?</p></div>
  </div>
  

  <div id="change-142465" class="journal has-notes has-details">
    <h4><a href="39740.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-11-27" title="2012-11-27 15:54">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Needs Feedback</i></li>
      
       <li><strong>Assigned To</strong> set to <i>Bastian Waidelich</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-142465-notes"><p>Hi Andreas,</p>


	<p>sorry for the late reaction. I stumbled upon this issue several times but I never completely got it ;)</p>


	<p>What's the difference between your example</p>


<pre>
<code class="yaml syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>  -
<span class="line-numbers">2</span>    <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">option A: fixed value as value of the route part name</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">3</span>    <span class="key">uriPattern</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api/v1/{@controller}/{@action}</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">4</span>    <span class="key">routeParts</span>:
<span class="line-numbers">5</span>      <span class="key"><span class="delimiter">'</span><span class="content">@package</span><span class="delimiter">'</span></span>:    <span class="string"><span class="content">'MyPackage'</span></span>
<span class="line-numbers">6</span>      <span class="key"><span class="delimiter">'</span><span class="content">@subpackage</span><span class="delimiter">'</span></span>: <span class="string"><span class="content">'Api'</span></span>
</span></code><br /></pre>

	<p>and</p>


<pre>
<code class="yaml syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>  -
<span class="line-numbers">2</span>    <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">option A: fixed value as value of the route part name</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">3</span>    <span class="key">uriPattern</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">api/v1/{@controller}/{@action}</span><span class="delimiter">&quot;</span></span> 
<span class="line-numbers">4</span>    <span class="key">defaults</span>:
<span class="line-numbers">5</span>      <span class="key"><span class="delimiter">'</span><span class="content">@package</span><span class="delimiter">'</span></span>:    <span class="string"><span class="content">'MyPackage'</span></span>
<span class="line-numbers">6</span>      <span class="key"><span class="delimiter">'</span><span class="content">@subpackage</span><span class="delimiter">'</span></span>: <span class="string"><span class="content">'Api'</span></span>
</span></code><br /></pre>

	<p>?</p></div>
  </div>
  

  <div id="change-142472" class="journal has-notes">
    <h4><a href="39740.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-11-27" title="2012-11-27 16:06">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-142472-notes"><p>The difference is that with defaults, these will be set if the value is not set at all. Therefore, all requests where no package/subpackage is set in the request will go to MyPackage\Api, which is not what I desire. I want it the other way round - only the requests to this subpackage have to match this route, no other requests. For them, I have a different URL scheme.</p></div>
  </div>
  

  <div id="change-142474" class="journal has-notes">
    <h4><a href="39740.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-11-27" title="2012-11-27 16:15">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-142474-notes"><p>Andreas Wolf wrote:</p>


<blockquote>

	<p>I want it the other way round - only the requests to this subpackage have to match this route, no other requests.</p>


</blockquote>

	<p>Not sure whether I got this now, let me rephrase:<br />In your example you want the route to match only if the request path is "api/v1/&lt;someController&gt;/&lt;someAction&gt;" <strong>AND</strong> some other request argument (e.g. POST) is array('@package' => 'MyPackage', 'subpackage' => 'Api') ?<br />Or how would you specify those in your example?</p></div>
  </div>
  

  <div id="change-142571" class="journal has-notes">
    <h4><a href="39740.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-11-28" title="2012-11-28 09:45">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-142571-notes"><p>Bastian Waidelich wrote:</p>


<blockquote>

	<p>Andreas Wolf wrote:</p>


<blockquote>

	<p>I want it the other way round - only the requests to this subpackage have to match this route, no other requests.</p>


</blockquote>

	<p>Not sure whether I got this now, let me rephrase:<br />In your example you want the route to match only if the request path is "api/v1/&lt;someController&gt;/&lt;someAction&gt;" <strong>AND</strong> some other request argument (e.g. POST) is array('@package' => 'MyPackage', 'subpackage' => 'Api') ?</p>


</blockquote>

	<p>No, I want all requests to /api/v1/.* to go to the Api subpackage. But I only want links to this subpackage to have a URL /api/v1/... This does not work if I set defaults, as all view helpers etc. where the package and/or subpackage is not set will then have these defaults applied - leading to errors because the controller is not found in the API subpackage.</p></div>
  </div>
  

  <div id="change-142605" class="journal has-notes">
    <h4><a href="39740.html#note-6" class="journal-link">#6</a>
    
    <a name="note-6"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-11-28" title="2012-11-28 12:28">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-142605-notes"><p>Andreas Wolf wrote:</p>


<blockquote><blockquote>

	<p>In your example you want the route to match only if the request path is "api/v1/&lt;someController&gt;/&lt;someAction&gt;" <strong>AND</strong> some other<br />request argument (e.g. POST) is array('@package' => 'MyPackage', 'subpackage' => 'Api') ?</p>


</blockquote></blockquote>

<blockquote>

	<p>No, I want all requests to /api/v1/.* to go to the Api subpackage. But I only want links to this subpackage to have a URL /api/v1/...<br />This does not work if I set defaults, as all view helpers etc. where the package and/or subpackage is not set will then have these defaults<br />applied - leading to errors because the controller is not found in the API subpackage.</p>


</blockquote>

	<p>Thanks for your patience, now I'm with you!<br />I didn't get it at first, because the behavior you describe was meant to be the default.. That is: when creating an URI you have to set all values that are defined in the Routes default (except for @format which is a bit special)..</p>


	<p>I don't know when this changed or if it was broken form the start, but right now you can omit default values that are not part of the uriPattern..<br />Changing Route::compareAndRemoveMatchingDefaultValues() from</p>


<pre>
<code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">compareAndRemoveMatchingDefaultValues</span>(<span class="predefined">array</span> <span class="local-variable">$defaults</span>, <span class="predefined">array</span> &#38;<span class="local-variable">$routeValues</span>) {
<span class="line-numbers"> 2</span>    <span class="keyword">foreach</span> (<span class="local-variable">$defaults</span> <span class="keyword">as</span> <span class="local-variable">$key</span> =&gt; <span class="local-variable">$defaultValue</span>) {
<span class="line-numbers"> 3</span>        <span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>])) {
<span class="line-numbers"> 4</span>            <span class="keyword">if</span> (<span class="predefined">is_array</span>(<span class="local-variable">$defaultValue</span>)) {
<span class="line-numbers"> 5</span>                <span class="keyword">if</span> (!<span class="predefined">is_array</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>])) {
<span class="line-numbers"> 6</span>                    <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers"> 7</span>                }
<span class="line-numbers"> 8</span>                <span class="keyword">return</span> <span class="local-variable">$this</span>-&gt;compareAndRemoveMatchingDefaultValues(<span class="local-variable">$defaultValue</span>, <span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>]);
<span class="line-numbers"> 9</span>            } <span class="keyword">elseif</span> (<span class="predefined">is_array</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>])) {
<span class="line-numbers"><strong>10</strong></span>                <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers">11</span>            }
<span class="line-numbers">12</span>            <span class="keyword">if</span> (<span class="predefined">strtolower</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>]) !== <span class="predefined">strtolower</span>(<span class="local-variable">$defaultValue</span>)) {
<span class="line-numbers">13</span>                <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers">14</span>            }
<span class="line-numbers">15</span>            <span class="predefined">unset</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>]);
<span class="line-numbers">16</span>        }
<span class="line-numbers">17</span>    }
<span class="line-numbers">18</span>    <span class="keyword">return</span> <span class="predefined-constant">TRUE</span>;
<span class="line-numbers">19</span>}
</span></code><br /></pre>

	<p>to</p>


<pre>
<code class="php syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">compareAndRemoveMatchingDefaultValues</span>(<span class="predefined">array</span> <span class="local-variable">$defaults</span>, <span class="predefined">array</span> &#38;<span class="local-variable">$routeValues</span>) {
<span class="line-numbers"> 2</span>    <span class="keyword">foreach</span> (<span class="local-variable">$defaults</span> <span class="keyword">as</span> <span class="local-variable">$key</span> =&gt; <span class="local-variable">$defaultValue</span>) {
<span class="line-numbers"> 3</span>        <span class="keyword">if</span> (!<span class="predefined">isset</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>])) {
<span class="line-numbers"> 4</span>            <span class="keyword">if</span> (<span class="local-variable">$defaultValue</span> === <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span> || (<span class="local-variable">$key</span> === <span class="string"><span class="delimiter">'</span><span class="content">@format</span><span class="delimiter">'</span></span> &#38;&#38; <span class="local-variable">$defaultValue</span> === <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span>)) {
<span class="line-numbers"> 5</span>                <span class="keyword">continue</span>;
<span class="line-numbers"> 6</span>            }
<span class="line-numbers"> 7</span>            <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers"> 8</span>        }
<span class="line-numbers"> 9</span>        <span class="keyword">if</span> (<span class="predefined">is_array</span>(<span class="local-variable">$defaultValue</span>)) {
<span class="line-numbers"><strong>10</strong></span>            <span class="keyword">if</span> (!<span class="predefined">is_array</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>])) {
<span class="line-numbers">11</span>                <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers">12</span>            }
<span class="line-numbers">13</span>            <span class="keyword">return</span> <span class="local-variable">$this</span>-&gt;compareAndRemoveMatchingDefaultValues(<span class="local-variable">$defaultValue</span>, <span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>]);
<span class="line-numbers">14</span>        } <span class="keyword">elseif</span> (<span class="predefined">is_array</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>])) {
<span class="line-numbers">15</span>            <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers">16</span>        }
<span class="line-numbers">17</span>        <span class="keyword">if</span> (<span class="predefined">strtolower</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>]) !== <span class="predefined">strtolower</span>(<span class="local-variable">$defaultValue</span>)) {
<span class="line-numbers">18</span>            <span class="keyword">return</span> <span class="predefined-constant">FALSE</span>;
<span class="line-numbers">19</span>        }
<span class="line-numbers"><strong>20</strong></span>        <span class="predefined">unset</span>(<span class="local-variable">$routeValues</span>[<span class="local-variable">$key</span>]);
<span class="line-numbers">21</span>    }
<span class="line-numbers">22</span>    <span class="keyword">return</span> <span class="predefined-constant">TRUE</span>;
<span class="line-numbers">23</span>}
</span></code><br /></pre>

	<p>fixes this for me, but it would be quite a breaking change probably..<br />could you please verify if that works for you?</p>


	<p>BTW: To make debugging with fluid easier you can replace line 263 of AbstractViewHelper from <code>throw $exception;</code> to <code>return $exception->getMessage();</code> – we'll fix this in fluid asap</p></div>
  </div>
  

  <div id="change-145694" class="journal has-notes has-details">
    <h4><a href="39740.html#note-7" class="journal-link">#7</a>
    
    <a name="note-7"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2012-12-18" title="2012-12-18 15:11">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Needs Feedback</i> to <i>Closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-145694-notes"><p>This should be resolved with <a href="43589.html" class="issue status-7 priority-2 closed" title="Route defaults can be omitted when creating URIs (Resolved)">#43589</a> Please reopen/comment if that did not solve your issue</p></div>
  </div>
  

  <div id="change-157996" class="journal has-notes has-details">
    <h4><a href="39740.html#note-8" class="journal-link">#8</a>
    
    <a name="note-8"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-04" title="2013-04-04 09:41">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Closed</i> to <i>New</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-157996-notes"><p>I just upgraded our project to recent master and it seems we still have problems.</p>


	<p>I've got this route configuration:</p>


<pre><code>
  name: 'Pools'
  uriPattern: 'admin/pools(/{@action})'
  defaults:
    '@package':    'MyPackageB'
    '@controller': 'Pool'
    '@action':     'index'
</code></pre>

	<p>MyPackageB is a side package for some things that have nothing to do with my main package, so most routes go to the other package.</p>


	<p>The problem here is that I have another route configured that matches a path like /admin/pools. Flow assumes that I want the controller "admin" from "MyPackageA", but that's plain wrong, because there is no such controller. Instead, the route given above should match.</p>


	<p>Could it be a problem that the route given above is below the route that is used by Flow instead?</p></div>
  </div>
  

  <div id="change-158001" class="journal has-notes has-details">
    <h4><a href="39740.html#note-9" class="journal-link">#9</a>
    
    <a name="note-9"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-04" title="2013-04-04 10:20">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Needs Feedback</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-158001-notes"><p>Andreas Wolf wrote:</p>


	<p>Hi Andreas,</p>


<blockquote>

	<p>Could it be a problem that the route given above is below the route that is used by Flow instead?</p>


</blockquote>

	<p>Yes, sure, "The first route that matches, determines which action will be called with what parameters." – see <a class="external" href="../../external.html?link=http://docs.typo3.org/flow/TYPO3FlowDocumentation/TheDefinitiveGuide/PartIII/Routing.html#the-router">http://docs.typo3.org/flow/TYPO3FlowDocumentation/TheDefinitiveGuide/PartIII/Routing.html#the-router</a></p>


	<p>Can you please post the route that should not match but does?</p></div>
  </div>
  

  <div id="change-158004" class="journal has-notes">
    <h4><a href="39740.html#note-10" class="journal-link">#10</a>
    
    <a name="note-10"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-04-04" title="2013-04-04 10:37">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-158004-notes"><p>BTW: With<br /><pre>
./flow routing:list
</pre></p>


	<p>you can see in what order the routes are processed. Try including your "MyPackageB" routes before the "MyPackageA" routes or refine the routes to make them more specific</p></div>
  </div>
  

  <div id="change-163796" class="journal has-notes has-details">
    <h4><a href="39740.html#note-11" class="journal-link">#11</a>
    
    <a name="note-11"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-07" title="2013-05-07 18:41">about 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Needs Feedback</i> to <i>Closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-163796-notes"><p>Closing due to lack of feedback (feel free to re-open or comment if this issue is still relevant)</p></div>
  </div>
  

  <div id="change-167301" class="journal has-notes">
    <h4><a href="39740.html#note-12" class="journal-link">#12</a>
    
    <a name="note-12"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-29" title="2013-05-29 09:45">about 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-167301-notes"><p>In fact, it is almost resolved. I tried it with plain Flow master today (well, mostly, I still have some custom patches applied, but they don't matter for this issue).</p>


	<p>All in all <a href="43589.html" class="issue status-7 priority-2 closed" title="Route defaults can be omitted when creating URIs (Resolved)">#43589</a> solved most of my problems. One still remains though:</p>


	<p>When building a route for these values (taken from System_Development.log):</p>


<pre>
@action =&gt; index
@controller =&gt; user
@package =&gt; mypackage
@subpackage =&gt; admin
@format =&gt; html
</pre>

	<p>with these routes (only the relevant ones)</p>


<pre><code class="yaml syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span>-
<span class="line-numbers"> 2</span>  <span class="key">name</span>: <span class="string"><span class="content">'User admin controller'</span></span>
<span class="line-numbers"> 3</span>  <span class="key">uriPattern</span>: <span class="string"><span class="content">'admin/user/{user}(/{@action})'</span></span>
<span class="line-numbers"> 4</span>  <span class="key">defaults</span>:
<span class="line-numbers"> 5</span>    <span class="key"><span class="delimiter">'</span><span class="content">@package</span><span class="delimiter">'</span></span>:    <span class="string"><span class="content">'MyPackage'</span></span>
<span class="line-numbers"> 6</span>    <span class="key"><span class="delimiter">'</span><span class="content">@subpackage</span><span class="delimiter">'</span></span>: <span class="string"><span class="content">'Admin'</span></span>
<span class="line-numbers"> 7</span>    <span class="key"><span class="delimiter">'</span><span class="content">@controller</span><span class="delimiter">'</span></span>: <span class="string"><span class="content">'User'</span></span>
<span class="line-numbers"> 8</span>    <span class="key"><span class="delimiter">'</span><span class="content">@action</span><span class="delimiter">'</span></span>:     <span class="string"><span class="content">'index'</span></span>
<span class="line-numbers"> 9</span>
<span class="line-numbers"><strong>10</strong></span>-
<span class="line-numbers">11</span>  <span class="key">name</span>: <span class="string"><span class="content">'Admin action'</span></span>
<span class="line-numbers">12</span>  <span class="key">uriPattern</span>: <span class="string"><span class="content">'admin/{@controller}(/{@action})'</span></span>
<span class="line-numbers">13</span>  <span class="key">defaults</span>:
<span class="line-numbers">14</span>    <span class="key"><span class="delimiter">'</span><span class="content">@package</span><span class="delimiter">'</span></span>:    <span class="string"><span class="content">'MyPackage'</span></span>
<span class="line-numbers">15</span>    <span class="key"><span class="delimiter">'</span><span class="content">@subpackage</span><span class="delimiter">'</span></span>: <span class="string"><span class="content">'Admin'</span></span>
<span class="line-numbers">16</span>    <span class="key"><span class="delimiter">'</span><span class="content">@action</span><span class="delimiter">'</span></span>:     <span class="string"><span class="content">'index'</span></span>
</span></code></pre>

	<p>none of the routes matches, but instead a Flow default route is used. When I remove the default routes, exception #1301610453 is thrown.</p>


	<p>When invoking admin/user/ manually, it works perfectly - so somehow the router does not seem to match the values to the route, though it should (package and subpackage are fixed as defaults, the controller is given and the action is both given in the route values and in the route's defaults).</p></div>
  </div>
  

  <div id="change-167307" class="journal has-notes has-details">
    <h4><a href="39740.html#note-13" class="journal-link">#13</a>
    
    <a name="note-13"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-29" title="2013-05-29 11:18">about 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Closed</i> to <i>Needs Feedback</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-167307-notes"><p>Thanks for your feedback.</p>


Just for clarification:<br />We use the terms
	<ul>
	<li><strong>match</strong> for the mapping of a URI path to the route values (incoming)</li>
		<li><strong>resolve</strong> for mapping route values to an URI (outgoing)</li>
	</ul>


	<p>In your example the <strong>@package</strong> route value ("qrserver") is not equal to the routes default value "MyPackage".<br />Was that just a typo in the issue description?<br />Also your route values specify a <strong>@format</strong> which is not defined in the routes.</p></div>
  </div>
  

  <div id="change-167474" class="journal has-notes has-details">
    <h4><a href="39740.html#note-14" class="journal-link">#14</a>
    
    <a name="note-14"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/61">Bastian Waidelich</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-05-31" title="2013-05-31 11:45">about 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Needs Feedback</i> to <i>Closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-167474-notes"><p>Closing again due to lack of feedback. Feel free to comment anyways, I'm monitoring this issue.</p></div>
  </div>
  

  <div id="change-169186" class="journal has-notes">
    <h4><a href="39740.html#note-15" class="journal-link">#15</a>
    
    <a name="note-15"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow/activity?from=2013-06-12" title="2013-06-12 17:14">about 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-169186-notes"><p>Bastian Waidelich wrote:</p>


<blockquote>

	<p>Thanks for your feedback.</p>


Just for clarification:<br />We use the terms
	<ul>
	<li><strong>match</strong> for the mapping of a URI path to the route values (incoming)</li>
		<li><strong>resolve</strong> for mapping route values to an URI (outgoing)</li>
	</ul>


	<p>In your example the <strong>@package</strong> route value ("qrserver") is not equal to the routes default value "MyPackage".<br />Was that just a typo in the issue description?</p>


</blockquote>

	<p>I'm sorry, that was in fact a typo.</p>


<blockquote>

	<p>Also your route values specify a <strong>@format</strong> which is not defined in the routes.</p>


</blockquote>

	<p>The route values come from Flow internally. I thought that @format would be html by default nevertheless, so I did not really care about this. I added @format: 'html' to the defaults section of all routes now nonetheless, so let's see if it helps.</p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-39740-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/39740.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="39740.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/39740 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 22:01:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
