<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/44616 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 23:26:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Bug #44616: Image caching broken for im_noScaleUp = 1 - Core - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/44616.atom" rel="alternate" title="Core - Bug #44616: Image caching broken for im_noScaleUp = 1" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 current sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/search" accesskey="4" style="">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>Core</h1>
        <div id="quicklinks"><p>Development of TYPO3 CMS</p></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/wiki" class="wiki">Wiki</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core" class="level-1 current sorting-10">Core</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3v4-search" class="level-2 sorting-0">Indexed Search</a><a href="../../external.html?link=https://forge.typo3.org/projects/extension-linkvalidator" class="level-2 sorting-0">Linkvalidator</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-releasecycles" class="level-2 sorting-0">Release Cycles</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-team" class="level-2 sorting-0">Team Resources</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3v4-workspaces" class="level-2 sorting-0">Workspaces & Versioning</a><a href="../../external.html?link=https://forge.typo3.org/projects/usability" class="level-2 sorting-10">TYPO3 CMS Usability Team</a><a href="../../external.html?link=https://forge.typo3.org/projects/extensions" class="level-1 sorting-20">Community Extensions</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3v4-distribution" class="level-1 sorting-44">Distributions</a><a href="../../external.html?link=https://forge.typo3.org/projects/cms-feature-requests" class="level-1 sorting-50">Feature-Requests</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-v62" class="level-1 sorting-620">TYPO3 6.2 Projects (+)</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-archived" class="level-1 sorting-1000">(Archived Projects)</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues/report">Summary</a><br />







<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=219" class="query">Easy tasks</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=391" class="query">FAL Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=204" class="query">Recently modified</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=523" class="query">Regressions</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/issues?query_id=459" class="query">Roadmap v7</a>



  
    <div id="watchers">
      

<h3>Watchers (2)</h3>

<ul><li><a href="../../external.html?link=https://forge.typo3.org/users/653">Christian Tauscher</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/users/27204">Dave Witassek</a></li></ul>

    </div>
  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-44616-watcher"></span>


</div>


<h2>Bug #44616</h2>

<div class="issue status-9 priority-1 closed details">
  

  

<div class="subject">
<div><h3>Image caching broken for im_noScaleUp = 1</h3></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/653">Christian Tauscher</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-01-17" title="2013-01-17 19:21">over 2 years</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-04-05" title="2013-04-05 10:55">over 2 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Closed</td>
    <th class="start-date">Start date:</th><td class="start-date">2013-01-17</td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Must have</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent">0%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">File Abstraction Layer (FAL)</td>
    
    <th class="spent-time">Spent time:</th>
    <td class="spent-time">-</td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version"><a href="../../external.html?link=https://forge.typo3.org/versions/2014">6.0.1</a></td>
    
</tr>
<tr>
	<th>TYPO3 Version:</th><td>6.0</td>
	<th>Is Regression:</th><td></td>
</tr>
<tr>
	<th>PHP Version:</th><td></td>
	<th>Sprint Focus:</th><td></td>
</tr>
<tr>
	<th>Complexity:</th><td></td>
</tr>


</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Regarding T3CMS V6.0.0</p>


	<p>In the BE first everyting is OK.<br />The CE Image is all OK, the preview is shown corectly<br />In FE all is OK, too.</p>


	<p>Then I have set im_noScaleUp = 1 in the install tool.</p>


	<p>Now, FE and BE are filled up with Errors:</p>


	<p>Uncaught TYPO3 Exception<br />#1329821485: File has been deleted. (More information)<br />RuntimeException thrown in file<br />typo3_src-6.0.0/typo3/sysext/core/Classes/Resource/AbstractFile.php in line 492.<br />9 TYPO3\CMS\Core\Resource\AbstractFile::getPublicUrl(boolean)<br />typo3_src-6.0.0/typo3/sysext/backend/Classes/Form/Element/InlineElement.php:<br />00555:      unset($imageSetup['field']);<br />00556:      $imageSetup = array_merge(array('width' => 64, 'height' => 64), $imageSetup);<br />00557:      $imageUrl = $fileObject->process(\TYPO3\CMS\Core\Resource\ProcessedFile::CONTEXT_IMAGEPREVIEW, $imageSetup)->getPublicUrl(TRUE);<br />00558:      $thumbnail = '' . htmlspecialchars($recTitle) . '';<br />00559:     } else {<br />...</p>


	<p>In BE and FE I have to click the reload Btton for every Image in the page, and jes, I have up to 1500pics on a single page! Happy Clicking.</p>


	<p>All image-cache is broken, a extbase-Extention with lots of pictures have the same problem.<br />Reloading the page once per image, heples.<br />Clearing the Cache, even by emptying the cache-table does bot help or deleting the temp-folder.</p>
  </div>








<hr />
<div id="relations">
<div class="contextual">

</div>

<p><strong>Related issues</strong></p>


<form>
<table class="list issues">

<tr class="issue hascontextmenu" id="relation-11189">
<td class="checkbox"><input name="ids[]" type="checkbox" value="58889" /></td>
<td class="subject">related to 
    Core - 
    <a href="58889.html" class="issue status-9 priority-1 closed">Bug #58889</a>: Checksum in generated images changes
</td>
<td class="status">Closed</td>
<td class="start_date">2014-05-17</td>
<td class="due_date"></td>
<td class="buttons"></td>
</tr>

<tr class="issue hascontextmenu" id="relation-7955">
<td class="checkbox"><input name="ids[]" type="checkbox" value="44073" /></td>
<td class="subject">related to 
    Core - 
    <a href="44073.html" class="issue status-7 priority-2 closed">Bug #44073</a>: Checksum needs to be updated after file processing
</td>
<td class="status">Resolved</td>
<td class="start_date">2012-12-17</td>
<td class="due_date"></td>
<td class="buttons"></td>
</tr>

<tr class="issue hascontextmenu" id="relation-7969">
<td class="checkbox"><input name="ids[]" type="checkbox" value="45308" /></td>
<td class="subject">related to 
    Core - 
    <a href="45308.html" class="issue status-7 priority-1 closed">Bug #45308</a>: uid of processed file is sometimes updated during processing
</td>
<td class="status">Resolved</td>
<td class="start_date">2013-02-09</td>
<td class="due_date"></td>
<td class="buttons"></td>
</tr>

<tr class="issue hascontextmenu" id="relation-7952">
<td class="checkbox"><input name="ids[]" type="checkbox" value="45168" /></td>
<td class="subject">duplicated by 
    Core - 
    <a href="45168.html" class="issue status-7 priority-1 closed">Bug #45168</a>: Wrong image displayed in FE if not resized
</td>
<td class="status">Resolved</td>
<td class="start_date">2013-02-05</td>
<td class="due_date"></td>
<td class="buttons"></td>
</tr>

</table>
</form>


<form action="../../external.html?link=https://forge.typo3.org/issues/44616/relations" id="new-relation-form" method="post" onsubmit="new Ajax.Request('/issues/44616/relations', {asynchronous:true, evalScripts:true, method:'post', onComplete:function(request){Form.Element.focus('relation_issue_to_id');}, parameters:Form.serialize(this)}); return false;" style="display: none;"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="IjgAk+sryuS7AAkPn7/ITUV652f6cwFBHN6GNTvW7o8=" /></div>


<p><select id="relation_relation_type" name="relation[relation_type]" onchange="setPredecessorFieldsVisibility();"><option value="relates">related to</option>
<option value="duplicates">duplicates</option>
<option value="duplicated">duplicated by</option>
<option value="blocks">blocks</option>
<option value="blocked">blocked by</option>
<option value="precedes">precedes</option>
<option value="follows">follows</option></select>
Issue #<input id="relation_issue_to_id" name="relation[issue_to_id]" size="10" type="text" />
<span id="predecessor_fields" style="display:none;">
Delay: <input id="relation_delay" name="relation[delay]" size="3" type="text" /> days
</span>
<input name="commit" type="submit" value="Add" />
<a href="#" onclick="Element.toggle('new-relation-form'); this.blur(); return false;">Cancel</a>
</p>

<div id="related_issue_candidates" class="autocomplete"></div>
<script type="text/javascript">
//<![CDATA[
observeRelatedIssueField('/issues/auto_complete?id=44616&amp;project_id=typo3cms-core')
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>

</div>


</div>


<div id="issue-changesets">
<h3>Associated revisions</h3>

    <div class="changeset odd">
    <p><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/repository/revisions/5516c309ad6196a6664b0e8d52f5073da846b352" title="Revision 5516c309">Revision 5516c309</a><br />
        <span class="author">Added by Andreas Wolf  <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-09" title="2013-02-09 12:09">over 2 years</a> ago</span></p>
    <div class="wiki">
        <p>[BUGFIX] Processed files get corrupted when regenerated</p>


	<p>After a file is being (re)processed, the information about it is updated<br />in the database by the ProcessedFileRepository. The repository gathers<br />information for the update from the processed file.</p>


	<p>For unprocessed files (i.e. those where the original file should be<br />used), the ProcessedFile class does a fallback to the original file<br />object. Unfortunately, this fallback is also applied for the uid<br />property, which makes the repository overwrite a random record in<br />sys_file_processedfile. This leads to wrong images being displayed in<br />the frontend.</p>


	<p>This patch makes the processed file only return its own uid.</p>


	<p>IMPORTANT: To make sure your sys_file_processedfile data is not<br />corrupted, empty the table and your processed files folder (usually<br />fileadmin/_processed_/). This will slow down your site as all processed<br />files are regenerated, but afterwards all data will be correct.</p>


	<p>Change-Id: I40685d5748a5a0fcf015c7d876a374f42154831d<br />Resolves: <a href="45308.html" class="issue status-7 priority-1 closed" title="uid of processed file is sometimes updated during processing (Resolved)">#45308</a><br />Related: <a href="44616.html" class="issue status-9 priority-1 closed" title="Image caching broken for im_noScaleUp = 1 (Closed)">#44616</a> <a href="45168.html" class="issue status-7 priority-1 closed" title="Wrong image displayed in FE if not resized (Resolved)">#45168</a><br />Releases: 6.1, 6.0<br />Reviewed-on: <a class="external" href="../../external.html?link=https://review.typo3.org/18145">https://review.typo3.org/18145</a><br />Reviewed-by: Helmut Hummel<br />Tested-by: Helmut Hummel<br />Reviewed-by: Anja Leichsenring<br />Tested-by: Anja Leichsenring</p>
    </div>
    </div>

    <div class="changeset even">
    <p><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/repository/revisions/91a1d0a35fd6b7eedabc90b1238a8c6b0a5074f5" title="Revision 91a1d0a3">Revision 91a1d0a3</a><br />
        <span class="author">Added by Andreas Wolf  <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-09" title="2013-02-09 12:23">over 2 years</a> ago</span></p>
    <div class="wiki">
        <p>[BUGFIX] Processed files get corrupted when regenerated</p>


	<p>After a file is being (re)processed, the information about it is updated<br />in the database by the ProcessedFileRepository. The repository gathers<br />information for the update from the processed file.</p>


	<p>For unprocessed files (i.e. those where the original file should be<br />used), the ProcessedFile class does a fallback to the original file<br />object. Unfortunately, this fallback is also applied for the uid<br />property, which makes the repository overwrite a random record in<br />sys_file_processedfile. This leads to wrong images being displayed in<br />the frontend.</p>


	<p>This patch makes the processed file only return its own uid.</p>


	<p>IMPORTANT: To make sure your sys_file_processedfile data is not<br />corrupted, empty the table and your processed files folder (usually<br />fileadmin/_processed_/). This will slow down your site as all processed<br />files are regenerated, but afterwards all data will be correct.</p>


	<p>Change-Id: I40685d5748a5a0fcf015c7d876a374f42154831d<br />Resolves: <a href="45308.html" class="issue status-7 priority-1 closed" title="uid of processed file is sometimes updated during processing (Resolved)">#45308</a><br />Related: <a href="44616.html" class="issue status-9 priority-1 closed" title="Image caching broken for im_noScaleUp = 1 (Closed)">#44616</a> <a href="45168.html" class="issue status-7 priority-1 closed" title="Wrong image displayed in FE if not resized (Resolved)">#45168</a><br />Releases: 6.1, 6.0<br />Reviewed-on: <a class="external" href="../../external.html?link=https://review.typo3.org/18153">https://review.typo3.org/18153</a><br />Reviewed-by: Andreas Wolf<br />Tested-by: Andreas Wolf</p>
    </div>
    </div>


</div>



<div id="history">
<h3>History</h3>

  <div id="change-148037" class="journal has-notes">
    <h4><a href="44616.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/653">Christian Tauscher</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-01-17" title="2013-01-17 20:33">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-148037-notes"><p>Workaround:</p>


	<p>truncate sys_file_processedfile</p>


	<p><em>seems</em> to solve the Problem. Dont know what this will have for side-Effects.</p>


	<p>Can this table (even ist a sys-table) deleted from time to time?</p></div>
  </div>
  

  <div id="change-148075" class="journal has-notes has-details">
    <h4><a href="44616.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-01-18" title="2013-01-18 09:23">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Category</strong> changed from <i>Caching</i> to <i>File Abstraction Layer (FAL)</i></li>
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Accepted</i></li>
      
       <li><strong>Assigned To</strong> set to <i>Andreas Wolf</i></li>
      
       <li><strong>Target version</strong> set to <i>6.0.1</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-148075-notes"><p>Christian Tauscher wrote:</p>


<blockquote>

	<p>Workaround:</p>


	<p>truncate sys_file_processedfile</p>


	<p><em>seems</em> to solve the Problem. Dont know what this will have for side-Effects.</p>


	<p>Can this table (even ist a sys-table) deleted from time to time?</p>


</blockquote>

	<p>Hm, no. This table is only a cache table, but you should not truncate it, otherwise all generated images have to be regenerated, so that's no viable solution for almost all sites.</p>


	<p>I guess the problem is that there is no proper detection that the image has not been reprocessed (because of the noscaleup parameter). The point is that a part of the cached image's identifier is a hash of the image processing information. Therefore, setting im_noscaleup does invalidate all cached images. I think that this together with the bug you found completely breaks your FE output.</p>


	<p>I'll try to dig into this, but my spare time is really limited currently. However, if you could contact me via Jabber, we can maybe sort this out a lot faster (Jabber ID awolf (at) jabber.ccc.de).</p></div>
  </div>
  

  <div id="change-148076" class="journal has-details">
    <h4><a href="44616.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-01-18" title="2013-01-18 09:24">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Subject</strong> changed from <i>Error thrown by FAL</i> to <i>Image caching broken for im_noScaleUp = 1</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-148094" class="journal has-notes">
    <h4><a href="44616.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/653">Christian Tauscher</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-01-18" title="2013-01-18 10:12">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-148094-notes"><p>Sorry, Andreas....<br />i have no idea how this jabber-dinges work.</p>


	<p>I should know about this - many of may cstomers like this Jabber-ICQ-ircchannels, but I never got into this. <br />What for? I have e-mail and a phone...? Maybe we could communicate throug one of this channels.</p>


	<p>Best regards from stone-age ;-)</p>


	<p>Christian.</p></div>
  </div>
  

  <div id="change-149980" class="journal has-notes">
    <h4><a href="44616.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/5379">Camelia M</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-04" title="2013-02-04 10:47">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-149980-notes"><p>I have a similar problem with im_noScaleUp = 1 but it's even weirder. I occasionally get different images in front-end then backend. I assume it's also related to caching because link in frontend leads to a (wrong) 'processed' image.</p></div>
  </div>
  

  <div id="change-150003" class="journal has-notes">
    <h4><a href="44616.html#note-6" class="journal-link">#6</a>
    
    <a name="note-6"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-04" title="2013-02-04 11:58">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150003-notes"><p>Camelia M wrote:</p>


<blockquote>

	<p>I have a similar problem with im_noScaleUp = 1 but it's even weirder. I occasionally get different images in front-end then backend. I assume it's also related to caching because link in frontend leads to a (wrong) 'processed' image.</p>


</blockquote>

	<p>I think your problems could be related to the files having the same filename after being replaced? Could you check <a href="44645.html" class="issue status-7 priority-2 closed" title="Preview images don't get a new filename after overwriting with updated file (Resolved)">#44645</a> if your situation is similar?</p></div>
  </div>
  

  <div id="change-150009" class="journal has-notes">
    <h4><a href="44616.html#note-7" class="journal-link">#7</a>
    
    <a name="note-7"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/5379">Camelia M</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-04" title="2013-02-04 13:38">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150009-notes"><p>Andreas Wolf wrote:</p>


<blockquote>

	<p>Camelia M wrote:</p>


<blockquote>

	<p>I have a similar problem with im_noScaleUp = 1 but it's even weirder. I occasionally get different images in front-end then backend. I assume it's also related to caching because link in frontend leads to a (wrong) 'processed' image.</p>


</blockquote>

	<p>I think your problems could be related to the files having the same filename after being replaced? Could you check <a href="44645.html" class="issue status-7 priority-2 closed" title="Preview images don't get a new filename after overwriting with updated file (Resolved)">#44645</a> if your situation is similar?</p>


</blockquote>

	<p>I'm afraid not. My images have different names and the filename in 'processed' folder is built as 'preview_'+original_name+some_unique_code.<br />But even though file names are not the same, as soon as I make 'im_noScaleUp = 1' images get mixed in a very strange way. (before activating no scale up images are corect, after activating, other images, with other sizes replace the correct ones).</p></div>
  </div>
  

  <div id="change-150021" class="journal has-notes">
    <h4><a href="44616.html#note-8" class="journal-link">#8</a>
    
    <a name="note-8"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/5379">Camelia M</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-04" title="2013-02-04 14:10">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150021-notes"><p>It seems I have several files that have originalfilesha1 identical. I think this is not normal. Is it?</p></div>
  </div>
  

  <div id="change-150035" class="journal has-notes">
    <h4><a href="44616.html#note-9" class="journal-link">#9</a>
    
    <a name="note-9"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/5379">Camelia M</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-04" title="2013-02-04 14:56">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150035-notes"><p>Camelia M wrote:</p>


<blockquote>

	<p>It seems I have several files that have originalfilesha1 identical. I think this is not normal. Is it?</p>


</blockquote>

	<p>And they also point to the same id of sys_file (column original in 'sys_file_processedfile') even tough they have a different name and they are completely different images.</p></div>
  </div>
  

  <div id="change-150324" class="journal has-notes">
    <h4><a href="44616.html#note-10" class="journal-link">#10</a>
    
    <a name="note-10"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-07" title="2013-02-07 11:50">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150324-notes"><p>Camelia M wrote:</p>


<blockquote>

	<p>Camelia M wrote:</p>


<blockquote>

	<p>It seems I have several files that have originalfilesha1 identical. I think this is not normal. Is it?</p>


</blockquote>

	<p>And they also point to the same id of sys_file (column original in 'sys_file_processedfile') even tough they have a different name and they are completely different images.</p>


</blockquote>

	<p>This is really weird. Would you mind providing me with a dump of your sys_file, sys_file_processedfile tables? You could send it to me via email so I can analyze it (just drop me a note to andreas.wolf (at) typo3.org).</p></div>
  </div>
  

  <div id="change-150414" class="journal has-notes">
    <h4><a href="44616.html#note-11" class="journal-link">#11</a>
    
    <a name="note-11"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-07" title="2013-02-07 22:07">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150414-notes"><p><em>(Crosspost from <a href="45168.html" class="issue status-7 priority-1 closed" title="Wrong image displayed in FE if not resized (Resolved)">#45168</a>)</em></p>


	<p>Could anyone of you who experiences this error run the following SQL query and report on the results?</p>


	<p><code>SELECT s.uid, f.storage, s.name AS processedname, s.identifier AS processedidentifier, f.name AS origname, f.identifier AS origidentifier, s.checksum FROM sys_file_processedfile AS s LEFT JOIN sys_file AS f ON s.uid=f.uid WHERE LOCATE(s.checksum, s.name) = 0</code></p>


	<p>The interesting part is if the name in <code>processedname</code> does not contain (parts of) <code>origname</code>. Then you experience a bug I found today with the help of Camelia.</p>


	<p>I am not sure what causes the bug, but its pretty obvious that at some point the uids of the processed file and the original file get mixed up and the database ends corrupted. This is however no problem, as we can simply flush the processed file cache once this bug is fixed.</p></div>
  </div>
  

  <div id="change-150486" class="journal has-notes">
    <h4><a href="44616.html#note-12" class="journal-link">#12</a>
    
    <a name="note-12"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-08" title="2013-02-08 12:58">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-150486-notes"><p>After reading the issue description again, I realized that this is in fact a duplicate of <a href="44073.html" class="issue status-7 priority-2 closed" title="Checksum needs to be updated after file processing (Resolved)">#44073</a>. The patch for this solves the issue with a wrong checksum, which lead to the original problem.</p>


	<p>The hint I found with the non-matching checksum in filename and checksum column is therefore invalid - the search goes on...</p></div>
  </div>
  

  <div id="change-150651" class="journal has-notes has-details">
    <h4><a href="44616.html#note-13" class="journal-link">#13</a>
    
    <a name="note-13"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-09" title="2013-02-09 11:19">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Accepted</i> to <i>Needs Feedback</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-150651-notes"><p>I will close this issue soon if nobody can reproduce this with 6.0.1.</p></div>
  </div>
  

  <div id="change-151004" class="journal has-notes">
    <h4><a href="44616.html#note-14" class="journal-link">#14</a>
    
    <a name="note-14"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/653">Christian Tauscher</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-02-12" title="2013-02-12 11:06">over 2 years</a> ago</h4>

    
    <div class="wiki" id="journal-151004-notes"><p>This issue seems to be fixed with an update on 6.0.1</p>


	<p>Thank you for your work.</p>


	<p>Christian.</p></div>
  </div>
  

  <div id="change-158086" class="journal has-notes has-details">
    <h4><a href="44616.html#note-15" class="journal-link">#15</a>
    
    <a name="note-15"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/43">Andreas Wolf</a> <a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms-core/activity?from=2013-04-05" title="2013-04-05 10:55">over 2 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Needs Feedback</i> to <i>Closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-158086-notes"><p>Closing this as presumably the problem has been fixed with 6.0.1</p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-44616-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/44616.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="44616.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/44616 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 23:26:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
