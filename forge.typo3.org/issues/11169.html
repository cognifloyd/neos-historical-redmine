<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from forge.typo3.org/issues/11169 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 21:57:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Story #11169: Implement new operator support - TYPO3 Flow Base Distribution - TYPO3 Forge</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<link href="../themes/TYPO3/stylesheets/applicationfaba.css?1437165176" media="all" rel="stylesheet" type="text/css" />
<script src="../javascripts/prototypefaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/effectsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/dragdropfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/controlsfaba.js?1437165176" type="text/javascript"></script>
<script src="../javascripts/applicationfaba.js?1437165176" type="text/javascript"></script>
<script src="../plugin_assets/flow_design_helpers/javascripts/custom-scriptsf881.js?1437165331" type="text/javascript"></script>

<!--[if IE]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1437165176);}
    </style>
<![endif]-->
 <link href="../plugin_assets/redmine_backlogs/stylesheets/jquery/jquery.jqplot.minb674.css?1437165332" media="screen" rel="stylesheet" type="text/css" />

<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-1.6.2.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery-ui-1.8.16.custom.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jeditable.minib674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.scrollfollowb674.js?1437165332" type="text/javascript"></script>

<!--[if IE]>
<script src="/plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/excanvas.js?1437165332" type="text/javascript"></script>
<![endif]-->
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/jquery.jqplotb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.highlighterb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasTextRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.canvasAxisTickRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.jqplot/plugins/jqplot.enhancedLegendRenderer.minb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/jquery/jquery.cookieb674.js?1437165332" type="text/javascript"></script>

<script type="text/javascript"
        src="../rb/server_variables.js">
</script>
<script src="../plugin_assets/redmine_backlogs/javascripts/commonb674.js?1437165332" type="text/javascript"></script>
<script src="../plugin_assets/redmine_backlogs/javascripts/burndownb674.js?1437165332" type="text/javascript"></script>


<style type="text/css">

</style>

<!-- page specific tags -->

    <link href="../../external.html?link=https://forge.typo3.org/issues/11169.atom" rel="alternate" title="TYPO3 Flow Base Distribution - Story #11169: Implement new operator support" type="application/atom+xml" />
    <link href="../themes/TYPO3/stylesheets/scmfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" />
<script src="../javascripts/context_menufaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/context_menufaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /><script src="../javascripts/jstoolbar/jstoolbarfaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/textilefaba.js?1437165176" type="text/javascript"></script><script src="../javascripts/jstoolbar/lang/jstoolbar-enfaba.js?1437165176" type="text/javascript"></script><link href="../stylesheets/jstoolbarfaba.css?1437165176" media="screen" rel="stylesheet" type="text/css" /></head>
<body>
<div id="wrapper">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/login" class="login">Sign in</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../../external.html?link=https://forge.typo3.org/" class="home">Home</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects" class="projects">Projects</a></li>
<li><a href="../../external.html?link=http://www.redmine.org/guide" class="help">Help</a></li></ul></div>
      
<div id="header">
    <div id="header-left">
        <div id="header-menu">
            <a href="../../external.html?link=https://forge.typo3.org/" class="start">Start</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3cms" class="level-0 sorting-10">TYPO3 CMS</a><a href="../../external.html?link=https://forge.typo3.org/projects/typo3neos" class="level-0 sorting-20">TYPO3 Neos</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3" class="level-0 current sorting-20">TYPO3 Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/team-docteam" class="level-0 sorting-26">Documentation</a><a href="../../external.html?link=https://forge.typo3.org/projects/other" class="level-0 sorting-30">other</a>
        </div>
    </div>
    
    <div id="right-area"  style="">
        <div id="quick-search">
            <form action="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/search" method="get">
            <input name="issues" type="hidden" value="1" />
            <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/search" accesskey="4" style="">Search</a>:
            <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
            </form>
        </div>

        <h1>TYPO3 Flow Base Distribution</h1>
        <div id="quicklinks"></div>
    </div>
    
    <div id="main-menu">
        <input class="projectsearch placeholder" id="projectname_project" name="projectname[project]" onfocus="this.value = &quot;&quot;; $(this).removeClassName(&quot;placeholder&quot;);" size="30" type="text" value="Project title search" /><div class="auto_complete" id="projectname_project_auto_complete"></div><script type="text/javascript">
//<![CDATA[
var projectname_project_auto_completer = new Ajax.Autocompleter('projectname_project', 'projectname_project_auto_complete', '/projects/auto_complete', {afterUpdateElement:function(element, value) { var identNode = $(value).select(".identifier"); window.location.href="/projects/"+identNode[0].innerHTML }})
//]]>
</script>
        <ul><li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="overview">Overview</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity" class="activity">Activity</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues" class="issues selected">Issues</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/rb/master_backlog/flow3-distribution-base" class="rb-master-backlogs">Backlogs</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues/calendar" class="calendar">Calendar</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div class="" id="main">
    <div id="leftmenu">
        <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base" class="level-1 current sorting-0">TYPO3 Flow Base Distribution</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-eel" class="level-2 sorting-0">TYPO3.Eel</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-flow" class="level-2 sorting-0">TYPO3.Flow</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-fluid" class="level-2 sorting-0">TYPO3.Fluid</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-kickstart" class="level-2 sorting-0">TYPO3.Kickstart</a><a href="../../external.html?link=https://forge.typo3.org/projects/package-typo3-welcome" class="level-2 sorting-0">TYPO3.Welcome</a><a href="../../external.html?link=https://forge.typo3.org/projects/packages" class="level-1 sorting-10">Packages</a><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-apps" class="level-1 sorting-30">Applications</a>
    </div>
    <div id="sidebar">        
        
  <h3>Issues</h3>
<a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?set_filter=1">View all issues</a><br />

<a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues/report">Summary</a><br />




  <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues/calendar">Calendar</a><br />



            <div id="backlogs_view_issues_sidebar"></div>
            <script type="text/javascript">
              jQuery(document).ready(function() {
                jQuery('#backlogs_view_issues_sidebar').load('../../external.html?link=https://forge.typo3.org/rb/hooks/sidebar/sprint/786?project_id=flow3-distribution-base');
              });
            </script>
          

<h3>Custom queries</h3><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=133" class="query">Hierarchical Issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=369" class="query">Issues under review</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=322" class="query">Most wanted Bugfixes</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=321" class="query">Most wanted Features</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=167" class="query">My open issues</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=203" class="query">New &amp; Unassigned</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=90" class="query">Open Bugs</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=262" class="query">Open Issues for 1.0.6</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=192" class="query">Open issues for 1.1.1</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=463" class="query">Open issues for 2.0</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=427" class="query">Open issues for 2.0.x</a><br /><a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/issues?query_id=204" class="query">Recently modified</a>



  
    <div id="watchers">
      

<h3>Watchers (2)</h3>

<ul><li><a href="../../external.html?link=https://forge.typo3.org/users/4714">Benjamin Eberlei</a></li>
<li><a href="../../external.html?link=https://forge.typo3.org/users/10">Karsten Dambekalns</a></li></ul>

    </div>
  

        
    </div>
    
    <div id="content">
				
        <div class="contextual">


<span class="issue-11169-watcher"></span>


</div>


<h2>Story #11169</h2>

<div class="issue status-7 priority-2 closed parent details">
  

  

<div class="subject">
<div><h3>Implement new operator support</h3></div>
</div>
        <p class="author">
        Added by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-11-30" title="2010-11-30 15:15">over 4 years</a> ago.
        
        Updated <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 09:24">about 4 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">Resolved</td>
    <th class="start-date">Start date:</th><td class="start-date"></td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Should have</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assigned To:</th><td class="assigned-to"><a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a></td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="closed" style="width: 40%;"></td><td class="todo" style="width: 60%;"></td></tr></table><p class="pourcent">40%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">-</td>
    
    <th></th>
    <td></td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version"><a href="../../external.html?link=https://forge.typo3.org/versions/786">1.0 beta 1</a></td>
    
</tr>

<tr><th>Story points</th><td>-</td></tr><tr><th>Velocity based estimate</th><td>-</td></tr>
</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Refactor FLOW3 so that the PHP "new" operator can be used instead of  ObjectManager->create()</p>
  </div>






<hr />
<div id="issue_tree">
<div class="contextual">
  
</div>
<p><strong>Subtasks</strong></p>
<form><table class="list issues"><tr class="issue issue-13703 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="13703" /></td><td class="subject"><a href="13703.html" class="issue status-7 priority-2 closed child">Task #13703</a>: Fix file monitoring / optimize compile step</td><td>Resolved</td><td><a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr><tr class="issue issue-13702 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="13702" /></td><td class="subject"><a href="13702.html" class="issue status-7 priority-2 closed child">Task #13702</a>: Replace remaining uses of objectManager-&gt;create() with ne...</td><td>Resolved</td><td></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr><tr class="issue issue-12099 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="12099" /></td><td class="subject"><a href="12099.html" class="issue status-7 priority-2 closed child">Task #12099</a>: Check feasibility and create rough concept</td><td>Resolved</td><td><a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr><tr class="issue issue-12100 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="12100" /></td><td class="subject"><a href="12100.html" class="issue status-7 priority-2 closed child">Task #12100</a>: Implement a generic Proxy Builder</td><td>Resolved</td><td><a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr><tr class="issue issue-13604 hascontextmenu "><td class="checkbox"><input name="ids[]" type="checkbox" value="13604" /></td><td class="subject"><a href="13604.html" class="issue status-7 priority-2 closed child">Task #13604</a>: Fix bugs and adjust affected code</td><td>Resolved</td><td><a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a></td><td><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent"></p></td></tr></table></form>
</div>




</div>




<div id="history">
<h3>History</h3>

  <div id="change-26747" class="journal has-notes">
    <h4><a href="11169.html#note-1" class="journal-link">#1</a>
    
    <a name="note-1"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4714">Benjamin Eberlei</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-11-30" title="2010-11-30 20:33">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-26747-notes"><p>I want to throw in <a class="external" href="../../external.html?link=https://github.com/sebastianbergmann/php-test-helpers">https://github.com/sebastianbergmann/php-test-helpers</a></p>


	<p>This is called "test-helpers", however it is exactly useful for overwriting the new operator to implement AOP.</p></div>
  </div>
  

  <div id="change-27454" class="journal has-notes">
    <h4><a href="11169.html#note-2" class="journal-link">#2</a>
    
    <a name="note-2"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-16" title="2010-12-16 19:36">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-27454-notes"><p>Hey,</p>


	<p>as already discussed with you @Robert, I don't see this as a high priority right now. Just wanted to add this to the issue, so it does not get lost :-)</p>


	<p>Greets,<br />Sebastian<br />PS: @Benjamin: It's great that you're active here, helping us with the Doctrine evaluation :-)</p></div>
  </div>
  

  <div id="change-27858" class="journal has-notes">
    <h4><a href="11169.html#note-3" class="journal-link">#3</a>
    
    <a name="note-3"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-21" title="2010-12-21 16:24">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-27858-notes"><p>An important argument against using the new operator is testability. If classes create their own prototypes (prototypes in the context of FLOW3), there is no easy way to mock them. That's exactly the reason why PHP-test-helpers were developed.</p>


	<p>On the other hand, if we can afford to require the use of such a custom PHP extension for testing then it might make sense to keep on exploring this topic.</p></div>
  </div>
  

  <div id="change-27859" class="journal has-notes">
    <h4><a href="11169.html#note-4" class="journal-link">#4</a>
    
    <a name="note-4"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4714">Benjamin Eberlei</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-21" title="2010-12-21 16:33">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-27859-notes"><p>Hm I disagree!</p>


	<p>You already mention prototypes in the context of Flwo3and mix it with php test helpers. Your reasoning would imply that php-test-helpers was developed for Flow3. It was developed for applications that don't use dependency injection.</p>


	<p>But Dependency Injection is independent of the problem newable vs injectable, which is discussed here:</p>


	<p><a class="external" href="../../external.html?link=http://misko.hevery.com/2008/09/30/to-new-or-not-to-new/">http://misko.hevery.com/2008/09/30/to-new-or-not-to-new/</a></p>


	<p>and also in Evans Domain Driven Design (Entities and Services chapter).</p>


	<p>I don't say you ObjectManager::create is bad per se. Its just bad for "newables" (Entities, Value objects and such).</p></div>
  </div>
  

  <div id="change-27863" class="journal has-notes">
    <h4><a href="11169.html#note-5" class="journal-link">#5</a>
    
    <a name="note-5"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-21" title="2010-12-21 16:58">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-27863-notes"><p>Benjamin Eberlei wrote:</p>


<blockquote>

	<p>You already mention prototypes in the context of Flwo3and mix it with php test helpers. Your reasoning would imply that php-test-helpers was developed for Flow3. It was developed for applications that don't use dependency injection.</p>


	<p>But Dependency Injection is independent of the problem newable vs injectable, which is discussed here:</p>


	<p><a class="external" href="../../external.html?link=http://misko.hevery.com/2008/09/30/to-new-or-not-to-new/">http://misko.hevery.com/2008/09/30/to-new-or-not-to-new/</a></p>


</blockquote>

	<p>Misko argues that there's no need to mock "leafs of the application"  because they are more or less like strings. I don't agree with that. I can easily imagine Entities which rely on a complex set of other objects which I'd rather unit-test separately and not alltogether. If I test a "Conference" object I want to see my test pass or fail because "Conference" is implemented right or wrong. It's confusing to see "Conference" tests fail because the "Address" object used by the "Venue" object created by the "Conference" object is buggy.</p>


<blockquote>

	<p>and also in Evans Domain Driven Design (Entities and Services chapter).<br />I don't say you ObjectManager::create is bad per se. Its just bad for "newables" (Entities, Value objects and such).</p>


</blockquote>

	<p>Hmm, I don't know. I guess you can produce okay code either way, it's rather a question of style. What I find appealing with the new-operator approach is that it a) doesn't require an Object Manager and b) is less to type. However, the ObjectManager->create() approach is easier to mock and more explicit about who's responsible for object creation.</p>


	<p>Certainly, we could go for a mixture of both (like Symfony tends to do), but that's the option I dislike most. I'd rather have everything consistent following the same conventions.</p></div>
  </div>
  

  <div id="change-27865" class="journal has-notes">
    <h4><a href="11169.html#note-6" class="journal-link">#6</a>
    
    <a name="note-6"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4714">Benjamin Eberlei</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-21" title="2010-12-21 17:27">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-27865-notes"><p>Miskos main argument is not about the leafes of an application, its about hard to test code if you violate the injectable vs newable rule, because in this case to be able to test newables you might need injectables. This is cumbersome to setup. In the case of FLOW3 its easy to explain:</p>


	<p>Why do i need to configure tons of mocking lines just to be able to test my simple "BlogPost" entity. Its supposed to be a domain object, not knowing anything about technical blabla such as an object manager. There is a a considerable difference between:</p>


<pre>
class BlogPost
{
    public function addComment($message, $email)
    {
         $comment = $this-&gt;objectManager-&gt;create("Comment", array($message, $email));
         $this-&gt;comments[] = $comment;
         return $comment;
    }
}

class BlogPost
{
    public function addComment($message, $email)
    {
         $comment = new Comment($message, $email);
         $this-&gt;comments[] = $comment;
         return $comment;
    }
}
</pre>

	<p>in regards to testing:</p>


<pre>
class BlogPostTest
{
    public function testSimpleNewable()
    {
        $post = new BlogPost();
        $comment = $post-&gt;addComment("hello world!", "kontakt@beberlei.de");

        $this-&gt;assertType("Comment", $comment);
        $this-&gt;assertEquals("hello world!", $comment-&gt;getMessage());
        $this-&gt;assertEquals(1, count($post-&gt;getcomments());
    }

    public function testComplexObjectManagerTest()
    {
        $message = "hello world!";
        $email = "kontakt@beberlei.de";

        $objectManager = $this-&gt;getMock('Some/Very/Long/PathTo/ObjectManager');
        $objectManager-&gt;expects($this-&gt;at(0));
                     -&gt;method('create');
                     -&gt;with($this-&gt;equalTo('Comment), $this-&gt;equalTo(array($message, $email))
                     -&gt;will($this-&gt;returnValue(new Comment($message, $email));

        $post = new BlogPost();
        $post-&gt;setObjectManager($objectManager); // rather simple, but what if you rely on reflection only here in your model?
        $comment = $post-&gt;addComment("hello world!", "kontakt@beberlei.de");

        $this-&gt;assertType("Comment", $comment);
        $this-&gt;assertEquals("hello world!", $comment-&gt;getMessage());
        $this-&gt;assertEquals(1, count($post-&gt;getcomments());
    }
}
</pre>

	<p>This is miles apart in terms of simplicity. Because test two violates the rule, never depend on injectables in your newables.</p>


	<p>Please also review the section on factories and aggregate roots in DDD, it specificially says entities / aggregate roots can create objects themselves not some object manager.</p>


	<p>Additionally the current approach means that you need the object manager as reference in EVERY object. Becaues whenever i want to create a new object I also need an object manager. That all just leads to very complicated and repetitive code. (as shown in the above test-example).</p></div>
  </div>
  

  <div id="change-27872" class="journal has-details">
    <h4><a href="11169.html#note-7" class="journal-link">#7</a>
    
    <a name="note-7"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-21" title="2010-12-21 18:41">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Assigned To</strong> set to <i>Robert Lemke</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-27873" class="journal has-details">
    <h4><a href="11169.html#note-8" class="journal-link">#8</a>
    
    <a name="note-8"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2010-12-21" title="2010-12-21 18:41">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>On Hold</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-28785" class="journal has-details">
    <h4><a href="11169.html#note-9" class="journal-link">#9</a>
    
    <a name="note-9"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-01-06" title="2011-01-06 14:13">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>On Hold</i> to <i>New</i></li>
      
       <li><strong>Parent task</strong> changed from <i>#10273</i> to <i>#11946</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-28786" class="journal has-details">
    <h4><a href="11169.html#note-10" class="journal-link">#10</a>
    
    <a name="note-10"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-01-06" title="2011-01-06 14:13">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Tracker</strong> changed from <i>Task</i> to <i>Story</i></li>
      
       <li><strong>Start date</strong> set to <i>2011-01-06</i></li>
      
       <li><strong>Parent task</strong> deleted (<strike><i>#11946</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-28795" class="journal has-details">
    <h4><a href="11169.html#note-11" class="journal-link">#11</a>
    
    <a name="note-11"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/11">Sebastian Kurfuerst</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-01-06" title="2011-01-06 14:22">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Position</strong> set to <i>2</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-29059" class="journal has-details">
    <h4><a href="11169.html#note-12" class="journal-link">#12</a>
    
    <a name="note-12"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-01-07" title="2011-01-07 12:34">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>New</i> to <i>Accepted</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-29472" class="journal has-details">
    <h4><a href="11169.html#note-13" class="journal-link">#13</a>
    
    <a name="note-13"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-01-11" title="2011-01-11 15:19">over 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Subject</strong> changed from <i>Explore possibility to use new operator instead of ObjectManager-&gt;create()</i> to <i>Implement new operator support</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-29476" class="journal has-notes">
    <h4><a href="11169.html#note-14" class="journal-link">#14</a>
    
    <a name="note-14"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/4714">Benjamin Eberlei</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-01-11" title="2011-01-11 15:25">over 4 years</a> ago</h4>

    
    <div class="wiki" id="journal-29476-notes"><p>So how will this work? Your tweet about it didn't release any technical details :-)</p></div>
  </div>
  

  <div id="change-73424" class="journal has-details">
    <h4><a href="11169.html#note-15" class="journal-link">#15</a>
    
    <a name="note-15"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-05" title="2011-05-05 13:51">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Project</strong> changed from <i>Core Team</i> to <i>Base Distribution</i></li>
      
       <li><strong>Target version</strong> deleted (<strike><i>788</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73539" class="journal has-details">
    <h4><a href="11169.html#note-16" class="journal-link">#16</a>
    
    <a name="note-16"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:12">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Project</strong> changed from <i>Base Distribution</i> to <i>TYPO3 Flow Base Distribution</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73540" class="journal has-details">
    <h4><a href="11169.html#note-17" class="journal-link">#17</a>
    
    <a name="note-17"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:12">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Target version</strong> set to <i>1.0 beta 1</i></li>
      
       <li><strong>Position</strong> deleted (<strike><i>17900</i></strike>)</li>
      
       <li><strong>Position</strong> set to <i>1</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73542" class="journal has-details">
    <h4><a href="11169.html#note-18" class="journal-link">#18</a>
    
    <a name="note-18"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:14">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Project</strong> changed from <i>TYPO3 Flow Base Distribution</i> to <i>Base Distribution</i></li>
      
       <li><strong>Target version</strong> changed from <i>1.0 beta 1</i> to <i>1228</i></li>
      
       <li><strong>Position</strong> deleted (<strike><i>2</i></strike>)</li>
      
       <li><strong>Position</strong> set to <i>1</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73547" class="journal has-details">
    <h4><a href="11169.html#note-19" class="journal-link">#19</a>
    
    <a name="note-19"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:17">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Project</strong> changed from <i>Base Distribution</i> to <i>TYPO3 Flow Base Distribution</i></li>
      
       <li><strong>Target version</strong> deleted (<strike><i>1228</i></strike>)</li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73552" class="journal has-details">
    <h4><a href="11169.html#note-20" class="journal-link">#20</a>
    
    <a name="note-20"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 08:17">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Target version</strong> set to <i>1.0 beta 1</i></li>
      
       <li><strong>Position</strong> deleted (<strike><i>1</i></strike>)</li>
      
       <li><strong>Position</strong> set to <i>1</i></li>
      
    </ul>
    
    
  </div>
  

  <div id="change-73591" class="journal has-details">
    <h4><a href="11169.html#note-21" class="journal-link">#21</a>
    
    <a name="note-21"></a>
    Updated by <a href="../../external.html?link=https://forge.typo3.org/users/8">Robert Lemke</a> <a href="../../external.html?link=https://forge.typo3.org/projects/flow3-distribution-base/activity?from=2011-05-06" title="2011-05-06 09:24">about 4 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>Accepted</i> to <i>Resolved</i></li>
      
    </ul>
    
    
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-11169-watcher"></span>


</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:
  <span><a href="../../external.html?link=https://forge.typo3.org/issues/11169.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="11169.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>







<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
				<div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>
	
<div id="footer">
 Powered by <a href="../../external.html?link=http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang<br /><br />
 Hosting sponsor:<br /><br />
 <script type="text/javascript">var buttonStyle = "footer-grey-31";</script>
 <script src="../../typo3.org/fileadmin/t3org/images/FM-content/team-pages/server-team/sponsor-banners/sponsors.js"></script>
</div>
</div>

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.typo3.org/" : "http://piwik.typo3.org/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script>
<noscript><span style="visibility: hidden";><img src="../../external.html?link=http://piwik.typo3.org/piwik.php?idsite=14" style="border:0" alt=""/></span></noscript>
</body>

<!-- Mirrored from forge.typo3.org/issues/11169 by HTTrack Website Copier/3.x [XR&CO'2008], Mon, 03 Aug 2015 21:57:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
</html>
